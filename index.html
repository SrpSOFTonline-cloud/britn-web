<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRITN - Professional Network</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 500: '#0D9488', 600: '#0F766E', 100: '#CCFBF1', 900: '#134E4A', 50: '#F0FDFA' },
                        surface: { 50: '#f8fafc', 100: '#f1f5f9', 800: '#1e293b', 900: '#0f172a' }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #F1F5F9; margin: 0; color: #334155; }
        .font-bangla { font-family: 'Hind Siliguri', sans-serif; }
        
        .loader { border: 3px solid #e2e8f0; border-top: 3px solid #0D9488; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Premium Theme Utilities */
        .sidebar-modern { background: linear-gradient(180deg, #134E4A 0%, #0F766E 100%); }
        .btn-brand { background: linear-gradient(135deg, #0D9488 0%, #14B8A6 100%); transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(13, 148, 136, 0.3); }
        .btn-brand:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(13, 148, 136, 0.4); }
        
        .card-hover { transition: all 0.3s ease; border: 1px solid #e2e8f0; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 12px 24px -10px rgba(0, 0, 0, 0.1); border-color: #5eead4; }

        .input-style { width: 100%; padding: 0.75rem 1rem; border: 1px solid #e2e8f0; border-radius: 0.75rem; outline: none; transition: all 0.2s; font-size: 0.875rem; background: #fff; }
        .input-style:focus { border-color: #0D9488; box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1); }

        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>
<body>
    <div id="root" style="height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div class="loader"></div>
    </div>

    <script type="module">
        import React from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

        // --- CONFIGURATION ---
        const BRITN_LOGO_URL = 'https://z-cdn-media.chatglm.cn/files/947017d9-2ded-4447-ab50-1dfd8ce35fcd.jpg?auth_key=1871748799-320010bf4fcc40a98d5d6172607e7c73-0-134513578fae2800da62ba56df7d4c44';
        
        const BKASH_LOGO = 'https://z-cdn-media.chatglm.cn/files/b5b51374-45c8-48a5-a311-72b9e1d5bc73.png?auth_key=1871751744-7d3a43f8ea5b4a88a771b12e20924738-0-c1d5c898a0b707d0b948e3ee2fb87914';
        const NAGAD_LOGO = 'https://z-cdn-media.chatglm.cn/files/e5bf331d-53cd-4abb-82fd-6e57c9eb02ff.jpg?auth_key=1871751744-7efbd889d92748fa86f18ec98cf52224-0-fa481f810d133047dc8c5020d1b0374b';
        
        const DONATION_NUMBER = '01843860547';
        const SUPABASE_URL = 'https://hosiwwylofzjtweclycv.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhvc2l3d3lsb2Z6anR3ZWNseWN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2NTc3ODgsImV4cCI6MjA4NzIzMzc4OH0.DkCioDXAQQYZm9NOhfsyuXvArR1TQjMMRf7OFv8FClA';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
        
        const ADMIN_EMAIL = 'admin@britn.com';
        const e = React.createElement;

        const safeFetch = async (query) => {
            try {
                const { data, error } = await query;
                if (error) throw error;
                return data || [];
            } catch (err) { console.error("Fetch Error:", err); return []; }
        };

        // --- Auth Screen ---
        const AuthScreen = ({ type, onSwitch, onSuccess }) => {
            const [form, setForm] = React.useState({ email: '', pass: '', name: '', role: 'student' });
            const [error, setError] = React.useState('');
            const [loading, setLoading] = React.useState(false);
            
            const handleAuth = async (ev) => {
                ev.preventDefault(); setError('');
                setLoading(true);
                try {
                    if (type === 'login') {
                        const { error } = await supabase.auth.signInWithPassword({ email: form.email, password: form.pass });
                        if (error) throw error;
                        onSuccess();
                    } else {
                        if (form.email === ADMIN_EMAIL) throw new Error("Cannot register with Admin Email.");
                        const { error } = await supabase.auth.signUp({
                            email: form.email, password: form.pass,
                            options: { data: { full_name: form.name, role: form.role } }
                        });
                        if (error) throw error;
                        alert("Registered! Please login.");
                        onSwitch('login');
                    }
                } catch (err) { setError(err.message); }
                finally { setLoading(false); }
            };

            return e('div', { className: "min-h-screen flex flex-col items-center justify-center bg-slate-50 p-4" },
                e('div', { className: "w-full max-w-md flex-1 flex flex-col justify-center" },
                    e('div', { className: "text-center mb-8" },
                        e('div', { className: "inline-block p-4 bg-white rounded-3xl shadow-sm border mb-4" },
                            e('img', { src: BRITN_LOGO_URL, alt: "Logo", className: "w-24 h-24 object-contain" })
                        ),
                        e('h1', { className: "text-3xl font-bold text-slate-800 tracking-tight" }, "BRITN"),
                        e('h2', { className: "text-md text-brand-600 mt-2 font-semibold font-bangla" }, 
                            "Bangladesh Radiology & Imaging Technologist Network"
                        )
                    ),
                    
                    e('div', { className: "bg-white p-8 rounded-3xl shadow-xl border border-slate-100" },
                        e('div', { className: "flex gap-2 mb-6" },
                            e('button', { 
                                onClick: () => onSwitch('login'),
                                className: `flex-1 py-2 text-sm font-semibold rounded-xl transition ${type === 'login' ? 'bg-brand-50 text-brand-700' : 'text-slate-400 hover:bg-slate-50'}`
                            }, "Login"),
                            e('button', { 
                                onClick: () => onSwitch('register'),
                                className: `flex-1 py-2 text-sm font-semibold rounded-xl transition ${type === 'register' ? 'bg-brand-50 text-brand-700' : 'text-slate-400 hover:bg-slate-50'}`
                            }, "Register")
                        ),
                        
                        error && e('div', { className: "bg-red-50 text-red-500 p-3 rounded-xl mb-4 text-sm text-center" }, error),
                        
                        e('form', { onSubmit: handleAuth, className: "space-y-4" },
                            type === 'register' && e('input', { placeholder: "Full Name", onChange: (ev) => setForm({...form, name: ev.target.value}), className: "input-style", required: true }),
                            e('input', { type: "email", placeholder: "Email Address", value: form.email, onChange: (ev) => setForm({...form, email: ev.target.value}), className: "input-style", required: true }),
                            e('input', { type: "password", placeholder: "Password", value: form.pass, onChange: (ev) => setForm({...form, pass: ev.target.value}), className: "input-style", required: true }),
                            type === 'register' && e('select', { onChange: (ev) => setForm({...form, role: ev.target.value}), className: "input-style bg-white text-slate-600" },
                                e('option', { value: "student" }, "Student"),
                                e('option', { value: "technologist" }, "Technologist"),
                                e('option', { value: "hospital" }, "Hospital")
                            ),
                            e('button', { type: "submit", disabled: loading, className: "w-full py-3 btn-brand text-white rounded-xl font-semibold text-sm disabled:opacity-50" }, 
                                loading ? "Please wait..." : (type === 'login' ? "Login" : "Create Account")
                            )
                        )
                    )
                ),
                // Developer Credit
                e('div', { className: "text-center py-4 text-xs text-slate-400" },
                    "Developed by ", e('span', { className: "font-bold text-brand-600" }, "SRP SOFT LTD")
                )
            );
        };

        // --- Sidebar ---
        const Sidebar = ({ page, setPage, onLogout, role, isOpen, setIsOpen, userEmail }) => {
            const isAdmin = userEmail === ADMIN_EMAIL || role === 'super_admin';
            const canPost = role === 'hospital' || role === 'technologist' || isAdmin;
            
            const menus = [
                { id: 'dash', name: 'Dashboard', icon: 'ðŸ“Š' },
                { id: 'jobs', name: 'Job Portal', icon: 'ðŸ’¼' },
                { id: 'reports', name: 'Report List', icon: 'ðŸš©' },
                { id: 'about', name: 'About', icon: 'â„¹ï¸' },
            ];
            const posterMenus = [ { id: 'add_job', name: 'Post Job', icon: 'âž•' }, { id: 'my_jobs', name: 'My Jobs', icon: 'ðŸ“' } ];
            const adminMenus = [ { id: 'approvals', name: 'Approve Jobs', icon: 'âœ…' }, { id: 'manage_all', name: 'Manage All', icon: 'ðŸ—‘ï¸' } ];

            const handleNav = (id) => { setPage(id); setIsOpen(false); };

            const sidebarClass = `fixed inset-y-0 left-0 z-40 w-72 sidebar-modern text-white transform sidebar-transition 
                ${isOpen ? 'translate-x-0' : '-translate-x-full'} 
                md:translate-x-0 md:static md:shadow-xl`;

            return e('div', { className: sidebarClass },
                e('div', { className: "p-6 flex items-center justify-between" },
                    e('div', { className: "flex items-center space-x-3" },
                        e('img', { src: BRITN_LOGO_URL, className: "w-10 h-10 object-contain rounded-lg bg-white p-1" }),
                        e('div', null, 
                            e('span', { className: "font-bold text-xl tracking-wide block" }, "BRITN"),
                            e('span', { className: "text-xs opacity-60 font-bangla" }, "Professional Network")
                        )
                    ),
                    e('button', { onClick: () => setIsOpen(false), className: "md:hidden text-white opacity-70" }, "âœ•")
                ),
                
                e('nav', { className: "flex-1 p-4 space-y-1 overflow-y-auto" },
                    menus.map(m => 
                        e('button', { key: m.id, onClick: () => handleNav(m.id), className: `w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-sm transition-all ${page === m.id ? 'bg-white/20 text-white shadow-md' : 'text-white/70 hover:bg-white/10'}` },
                            e('span', {className: "text-lg"}, m.icon), e('span', {className: "font-medium"}, m.name)
                        )
                    ),
                    canPost && e('div', {className: "mt-6 pt-4 border-t border-white/10"}, 
                        e('p', {className: "px-4 text-xs text-white/40 mb-2 uppercase tracking-wider font-semibold"}, "Management"),
                        posterMenus.map(m => 
                            e('button', { key: m.id, onClick: () => handleNav(m.id), className: `w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-sm transition-all ${page === m.id ? 'bg-white/20 text-white' : 'text-white/70 hover:bg-white/10'}` },
                                e('span', {className: "text-lg"}, m.icon), e('span', {className: "font-medium"}, m.name)
                            )
                        )
                    ),
                    isAdmin && e('div', {className: "mt-6 pt-4 border-t border-white/10"}, 
                        e('p', {className: "px-4 text-xs text-white/40 mb-2 uppercase tracking-wider font-semibold"}, "Admin Power"),
                        adminMenus.map(m => 
                            e('button', { key: m.id, onClick: () => handleNav(m.id), className: `w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-sm transition-all ${page === m.id ? 'bg-red-400/30 text-red-100' : 'text-white/70 hover:bg-white/10'}` },
                                e('span', {className: "text-lg"}, m.icon), e('span', {className: "font-medium"}, m.name)
                            )
                        )
                    )
                ),
                e('div', { className: "p-4 border-t border-white/10" },
                    e('button', { onClick: onLogout, className: "w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-red-200 text-sm hover:bg-red-500/20 transition-colors" }, 
                        e('span', {className: "text-lg"}, 'ðŸšª'), e('span', {className: "font-medium"}, "Logout")
                    )
                )
            );
        };

        // --- About Page (Enhanced Payment & Developer) ---
        const AboutPage = () => {
            return e('div', { className: "space-y-6" },
                e('div', { className: "bg-white p-8 rounded-2xl shadow-sm border text-center hover:shadow-md transition-shadow" },
                    e('img', { src: BRITN_LOGO_URL, className: "w-24 h-24 mx-auto mb-4 object-contain rounded-xl" }),
                    e('h1', { className: "text-2xl font-bold text-surface-900 font-bangla" }, "Bangladesh Radiology & Imaging Technologist Network"),
                    e('p', { className: "text-slate-500 text-sm mt-2 font-bangla" }, "à¦¦à¦•à§à¦· à¦°à§‡à¦¡à¦¿à¦“à¦²à¦œà¦¿ à¦ªà§‡à¦¶à¦¾à¦œà§€à¦¬à§€à¦¦à§‡à¦° à¦¸à¦‚à¦¯à§‹à¦— à¦¸à§à¦¥à¦¾à¦ªà¦¨à¥¤")
                ),

                // Enhanced Payment Section
                e('div', { className: "bg-gradient-to-br from-brand-600 to-teal-600 p-8 rounded-2xl shadow-xl text-white relative overflow-hidden" },
                    // Decorative circles
                    e('div', { className: "absolute top-0 right-0 w-40 h-40 bg-white opacity-10 rounded-full -mr-20 -mt-20" }),
                    e('div', { className: "absolute bottom-0 left-0 w-32 h-32 bg-white opacity-10 rounded-full -ml-16 -mb-16" }),
                    
                    e('div', { className: "relative z-10 text-center" },
                        e('h2', { className: "text-2xl font-bold mb-2 flex items-center justify-center gap-2" }, 
                            e('span', {className: "text-3xl"}, "â¤ï¸"), "à¦¸à¦¾à¦ªà§‹à¦°à§à¦Ÿ à¦•à¦°à§à¦¨"
                        ),
                        e('p', { className: "text-white/90 text-sm mb-6 max-w-lg mx-auto font-bangla leading-relaxed" }, 
                            "à¦†à¦ªà¦¨à¦¾à¦° à¦¸à¦¾à¦®à¦¾à¦¨à§à¦¯ à¦¸à¦¹à¦¯à§‹à¦—à¦¿à¦¤à¦¾ à¦†à¦®à¦¾à¦¦à§‡à¦° à¦à¦‡ à¦ªà§à¦²à§à¦¯à¦¾à¦Ÿà¦«à¦°à§à¦®à¦Ÿà¦¿ à¦¸à¦šà¦² à¦°à¦¾à¦–à¦¤à§‡ à¦“ à¦‰à¦¨à§à¦¨à¦¤ à¦•à¦°à¦¤à§‡ à¦¸à¦¾à¦¹à¦¾à¦¯à§à¦¯ à¦•à¦°à¦¬à§‡à¥¤ à¦¸à¦¾à¦°à§à¦­à¦¾à¦° à¦“ à¦°à¦•à§à¦·à¦£à¦¾à¦¬à§‡à¦•à§à¦·à¦£ à¦–à¦°à¦š à¦¬à¦¹à¦¨à§‡ à¦…à¦‚à¦¶ à¦¨à¦¿à¦¨à¥¤"
                        ),
                        
                        e('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6 mt-8" },
                            // Bkash
                            e('div', { className: "bg-white/10 backdrop-blur-md p-6 rounded-xl border border-white/20 flex flex-col items-center justify-center hover:bg-white/20 transition-all" },
                                e('img', { src: BKASH_LOGO, className: "h-12 object-contain mb-3 brightness-0 invert", alt: "Bkash Logo" }),
                                e('p', { className: "text-sm opacity-80 mb-1 font-bangla" }, "à¦¬à¦¿à¦•à¦¾à¦¶ (à¦ªà¦¾à¦°à§à¦¸à§‹à¦¨à¦¾à¦²)"),
                                e('span', { className: "text-2xl font-bold tracking-widest font-mono" }, DONATION_NUMBER),
                                e('button', { onClick: () => { navigator.clipboard.writeText(DONATION_NUMBER); alert('Number Copied!'); }, className: "mt-3 px-6 py-2 bg-white text-brand-700 text-sm font-bold rounded-full shadow-lg hover:bg-slate-100" }, "Copy Number")
                            ),
                            // Nagad
                            e('div', { className: "bg-white/10 backdrop-blur-md p-6 rounded-xl border border-white/20 flex flex-col items-center justify-center hover:bg-white/20 transition-all" },
                                e('img', { src: NAGAD_LOGO, className: "h-12 object-contain mb-3 brightness-0 invert", alt: "Nagad Logo" }),
                                e('p', { className: "text-sm opacity-80 mb-1 font-bangla" }, "à¦¨à¦—à¦¦ (à¦ªà¦¾à¦°à§à¦¸à§‹à¦¨à¦¾à¦²)"),
                                e('span', { className: "text-2xl font-bold tracking-widest font-mono" }, DONATION_NUMBER),
                                e('button', { onClick: () => { navigator.clipboard.writeText(DONATION_NUMBER); alert('Number Copied!'); }, className: "mt-3 px-6 py-2 bg-white text-brand-700 text-sm font-bold rounded-full shadow-lg hover:bg-slate-100" }, "Copy Number")
                            )
                        )
                    )
                ),

                // Privacy Policy
                e('div', { className: "bg-white p-6 rounded-2xl shadow-sm border text-sm text-slate-600" },
                    e('h2', { className: "font-bold text-surface-800 mb-2 text-base font-bangla" }, "ðŸ“œ à¦—à§‹à¦ªà¦¨à§€à¦¯à¦¼à¦¤à¦¾ à¦¨à§€à¦¤à¦¿"),
                    e('p', { className: "font-bangla" }, "à¦†à¦®à¦°à¦¾ à¦ªà¦°à¦¿à¦šà¦¯à¦¼ à¦¯à¦¾à¦šà¦¾à¦‡ à¦•à¦°à¦¤à§‡ à¦¡à§‡à¦Ÿà¦¾ à¦¸à¦‚à¦—à§à¦°à¦¹ à¦•à¦°à¦¿à¥¤ à¦†à¦®à¦°à¦¾ à¦¡à§‡à¦Ÿà¦¾ à¦¬à¦¿à¦•à§à¦°à¦¿ à¦•à¦°à¦¿ à¦¨à¦¾à¥¤")
                ),

                // Developer Credit
                e('div', { className: "text-center pt-4 border-t border-slate-200" },
                    e('p', { className: "text-sm text-slate-400" }, 
                        "Developed with â¤ï¸ by ", 
                        e('span', { className: "font-bold text-brand-600" }, "SRP SOFT LTD")
                    )
                )
            );
        };

        // --- Report List (With Search) ---
        const ReportList = ({ user }) => {
            const [reports, setReports] = React.useState([]);
            const [form, setForm] = React.useState({ hospital_name: '', category: 'Bad Behavior', details: '' });
            const [msg, setMsg] = React.useState('');
            const [searchTerm, setSearchTerm] = React.useState(''); // Search State
            const isAdmin = user?.email === ADMIN_EMAIL;

            const fetchReports = async () => {
                const data = await safeFetch(supabase.from('hospital_reports').select('*').order('created_at', { ascending: false }).limit(50));
                setReports(data);
            };
            React.useEffect(() => { fetchReports(); }, []);

            const handleSubmit = async (ev) => {
                ev.preventDefault();
                if(!form.hospital_name || !form.details) { setMsg("Fill all fields"); return; }
                const { error } = await supabase.from('hospital_reports').insert([{...form, reporter_email: user?.email || 'Anonymous'}]);
                if(error) setMsg("Error: " + error.message);
                else { setMsg("Submitted Successfully!"); setForm({ hospital_name: '', category: 'Bad Behavior', details: '' }); fetchReports(); }
            };

            const handleDeleteReport = async (id) => {
                if(!confirm("Delete this report?")) return;
                const { error } = await supabase.from('hospital_reports').delete().eq('id', id);
                if(error) alert("Error deleting");
                else fetchReports();
            };

            // Filter Logic
            const filteredReports = reports.filter(r => 
                r.hospital_name.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return e('div', null,
                e('h2', { className: "text-xl font-bold mb-4 text-surface-900" }, "ðŸš© Report List"),
                
                // Search Input
                e('div', { className: "mb-4 relative" },
                    e('input', { 
                        type: "text", 
                        placeholder: "Search by Hospital or Institution Name...", 
                        className: "input-style pl-10 bg-white border-slate-200", 
                        value: searchTerm,
                        onChange: (e) => setSearchTerm(e.target.value)
                    }),
                    e('span', { className: "absolute left-3 top-3 text-slate-400" }, "ðŸ”")
                ),

                e('div', { className: "bg-white p-6 rounded-2xl shadow-sm border mb-6" },
                    e('h3', {className: "font-bold text-sm mb-3 font-bangla text-slate-700"}, "à¦¨à¦¤à§à¦¨ à¦°à¦¿à¦ªà§‹à¦°à§à¦Ÿ à¦œà¦®à¦¾ à¦¦à¦¿à¦¨"),
                    e('form', { onSubmit: handleSubmit, className: "space-y-3" },
                        e('input', { placeholder: "Hospital/Institution Name", value: form.hospital_name, onChange: (e) => setForm({...form, hospital_name: e.target.value}), className: "input-style" }),
                        e('select', { value: form.category, onChange: (e) => setForm({...form, category: e.target.value}), className: "input-style bg-white" },
                            e('option', { value: "Bad Behavior" }, "Bad Behavior"),
                            e('option', { value: "Salary Issue" }, "Salary Issue")
                        ),
                        e('textarea', { placeholder: "Details...", value: form.details, onChange: (e) => setForm({...form, details: e.target.value}), className: "input-style", rows: 3 }),
                        e('button', { className: "px-5 py-2 bg-red-500 text-white rounded-xl text-sm font-semibold hover:bg-red-600 transition-colors" }, "Submit Report")
                    )
                ),

                // Results Count
                e('p', {className: "text-xs text-slate-400 mb-2"}, `Showing ${filteredReports.length} reports.`),

                e('div', { className: "space-y-3" }, filteredReports.map(r => 
                    e('div', { key: r.id, className: "bg-white p-4 rounded-xl border hover:shadow-md transition-shadow text-sm flex justify-between items-start" },
                        e('div', { className: "flex-1" },
                            e('div', { className: "flex items-center gap-2 border-b pb-2 mb-2" }, 
                                e('span', {className: "font-bold text-surface-800"}, r.hospital_name), 
                                e('span', {className: "bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full text-xs font-medium"}, r.category)
                            ),
                            e('p', { className: "text-slate-600" }, r.details)
                        ),
                        isAdmin && e('button', { 
                            onClick: () => handleDeleteReport(r.id), 
                            className: "ml-4 text-xs bg-red-100 text-red-600 px-3 py-1 rounded-full hover:bg-red-200 font-medium h-fit"
                        }, "Remove")
                    )
                ))
            );
        };

        // --- Job List (With Search) ---
        const JobList = ({ title, filter, isAdmin, user }) => {
            const [jobs, setJobs] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            const [search, setSearch] = React.useState('');

            const fetchJobs = async () => {
                setLoading(true);
                let query = supabase.from('jobs').select('*');
                if (filter === 'pending') query = query.eq('is_approved', false);
                else if (filter === 'approved') query = query.eq('is_approved', true);
                else if (filter === 'my_posts') query = query.eq('poster_id', user.id);
                const data = await safeFetch(query.order('created_at', { ascending: false }).limit(20));
                setJobs(data); setLoading(false);
            };
            
            React.useEffect(() => { if(user) fetchJobs(); }, [filter, user]);

            const handleAction = async (id, action) => {
                if (!confirm("Are you sure?")) return;
                if (action === 'delete') await supabase.from('jobs').delete().eq('id', id);
                if (action === 'approve') await supabase.from('jobs').update({ is_approved: true }).eq('id', id);
                fetchJobs();
            };

            const filteredJobs = jobs.filter(j => 
                j.title.toLowerCase().includes(search.toLowerCase()) || 
                j.location.toLowerCase().includes(search.toLowerCase())
            );

            if (loading) return e('div', {className: "flex justify-center py-10"}, e('div', {className: "loader"}));

            return e('div', null,
                e('div', { className: "flex justify-between items-center mb-4 flex-wrap gap-2" },
                    e('h2', { className: "text-xl font-bold text-surface-900" }, title),
                    e('input', { 
                        type: "text", 
                        placeholder: "Search jobs...", 
                        className: "input-style w-64",
                        value: search,
                        onChange: (e) => setSearch(e.target.value)
                    })
                ),
                filteredJobs.length === 0 && e('p', {className: "text-slate-400 text-center py-10 bg-white rounded-xl"}, "No jobs found."),
                e('div', { className: "space-y-3" }, filteredJobs.map(job => 
                    e('div', { key: job.id, className: "bg-white p-5 rounded-2xl border shadow-sm hover:shadow-md transition-all flex flex-col md:flex-row justify-between items-start gap-4 card-hover" },
                        e('div', { className: "flex-1" },
                            e('div', { className: "flex items-center gap-2" },
                                e('h3', { className: "font-bold text-surface-800" }, job.title),
                                !job.is_approved && e('span', { className: "bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded text-xs font-medium" }, "Pending")
                            ),
                            e('p', { className: "text-slate-500 text-sm mt-1" }, `ðŸ“ ${job.location} | ðŸ’° ${job.salary || 'Negotiable'}`),
                            e('p', { className: "text-slate-400 text-xs mt-2" }, job.description?.substring(0, 50) + '...')
                        ),
                        e('div', { className: "flex space-x-2" },
                            isAdmin && !job.is_approved && e('button', { onClick: () => handleAction(job.id, 'approve'), className: "px-4 py-2 bg-green-500 text-white rounded-lg text-xs font-semibold hover:bg-green-600 transition-colors shadow-sm" }, "Approve"),
                            (isAdmin || job.poster_id === user.id) && e('button', { onClick: () => handleAction(job.id, 'delete'), className: "px-4 py-2 bg-red-100 text-red-600 rounded-lg text-xs font-semibold hover:bg-red-200 transition-colors" }, "Delete")
                        )
                    )
                ))
            );
        };

        const AddJobForm = ({ user, isAdmin }) => {
            const [form, setForm] = React.useState({ title: '', location: '', salary: '', description: '' });
            const [msg, setMsg] = React.useState({ text: '', type: '' });

            const handleSubmit = async (ev) => {
                ev.preventDefault();
                if(!form.title || !form.location) {
                    setMsg({ text: "Title and Location required", type: 'error' });
                    return;
                }
                
                const jobData = { 
                    title: form.title,
                    location: form.location,
                    salary: form.salary,
                    description: form.description,
                    poster_id: user.id, 
                    is_approved: isAdmin ? true : false 
                };

                const { error } = await supabase.from('jobs').insert([jobData]);
                
                if (error) {
                    console.error(error);
                    setMsg({ text: "Error: " + error.message, type: 'error' });
                } else { 
                    setMsg({ text: isAdmin ? "Job Posted Successfully!" : "Submitted for Approval!", type: 'success' }); 
                    setForm({ title: '', location: '', salary: '', description: '' }); 
                }
            };

            return e('div', { className: "bg-white p-6 rounded-2xl shadow-sm border max-w-2xl" },
                e('h2', { className: "text-xl font-bold mb-4 text-surface-900" }, "Post a New Job"),
                msg.text && e('div', { className: `p-3 rounded-xl mb-4 text-sm ${msg.type === 'error' ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-600'}` }, msg.text),
                e('form', { onSubmit: handleSubmit, className: "space-y-3" },
                    e('input', { placeholder: "Job Title *", value: form.title, onChange: (e) => setForm({...form, title: e.target.value}), className: "input-style", required: true }),
                    e('input', { placeholder: "Location *", value: form.location, onChange: (e) => setForm({...form, location: e.target.value}), className: "input-style", required: true }),
                    e('input', { placeholder: "Salary", value: form.salary, onChange: (e) => setForm({...form, salary: e.target.value}), className: "input-style" }),
                    e('textarea', { placeholder: "Description", value: form.description, onChange: (e) => setForm({...form, description: e.target.value}), className: "input-style", rows: 4 }),
                    e('button', { type: "submit", className: "w-full py-3 btn-brand text-white rounded-xl font-semibold text-sm" }, "Submit Job")
                )
            );
        };

        // --- Dashboard ---
        const Dashboard = ({ user, setPage }) => {
            const isAdmin = user?.email === ADMIN_EMAIL;
            return e('div', { className: "space-y-6" },
                e('div', { className: "flex justify-between items-center" },
                    e('div', null,
                        e('h1', { className: "text-2xl font-bold text-surface-900" }, "Welcome Back! ðŸ‘‹"),
                        e('p', { className: "text-slate-500 text-sm mt-1 font-bangla" }, `Logged in as: ${user?.email}`)
                    ),
                    e('div', { className: "text-right" },
                        e('span', { className: "px-3 py-1 rounded-full text-xs font-bold bg-brand-100 text-brand-700 uppercase" }, user?.user_metadata?.role || "User")
                    )
                ),
                
                e('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-4" }, 
                    e('div', { className: "bg-white p-6 rounded-2xl border shadow-sm hover:shadow-md transition-all" }, 
                        e('div', { className: "flex justify-between items-center" },
                            e('div', null,
                                e('h3', { className: "text-slate-500 text-sm font-bangla" }, "à¦†à¦ªà¦¨à¦¾à¦° à¦…à¦¬à¦¸à§à¦¥à¦¾à¦¨"),
                                e('p', { className: "text-xl font-bold text-surface-900 mt-1 capitalize" }, user?.user_metadata?.role || "Member")
                            ),
                            e('span', { className: "text-3xl" }, "ðŸ‘¤")
                        )
                    ),
                    e('div', { className: "bg-white p-6 rounded-2xl border shadow-sm hover:shadow-md transition-all" }, 
                        e('div', { className: "flex justify-between items-center" },
                            e('div', null,
                                e('h3', { className: "text-slate-500 text-sm font-bangla" }, "à¦¸à§à¦Ÿà§à¦¯à¦¾à¦Ÿà¦¾à¦¸"),
                                e('p', { className: "text-xl font-bold text-green-600 mt-1 font-bangla" }, "à¦¸à¦•à§à¦°à¦¿à¦¯à¦¼")
                            ),
                            e('span', { className: "text-3xl" }, "âœ…")
                        )
                    ),
                    e('div', { className: "bg-white p-6 rounded-2xl border shadow-sm hover:shadow-md transition-all" }, 
                         e('div', { className: "flex justify-between items-center" },
                            e('div', null,
                                e('h3', { className: "text-slate-500 text-sm font-bangla" }, "Quick Link"),
                                e('p', { className: "text-xl font-bold text-brand-600 mt-1 font-bangla" }, "Find Jobs")
                            ),
                            e('button', { onClick: () => setPage('jobs'), className: "text-sm px-3 py-1 bg-brand-50 rounded-lg text-brand-700 font-medium" }, "View")
                        )
                    )
                ),

                e('div', { className: "bg-white p-6 rounded-2xl border shadow-sm" },
                    e('h3', { className: "font-bold text-surface-900 mb-4 font-bangla" }, "à¦¦à§à¦°à§à¦¤ à¦…à§à¦¯à¦¾à¦•à¦¶à¦¨"),
                    e('div', { className: "grid grid-cols-2 md:grid-cols-4 gap-3" }, 
                        e('button', { onClick: () => setPage('add_job'), className: "flex flex-col items-center justify-center p-4 bg-slate-50 rounded-xl hover:bg-brand-50 transition-colors" },
                            e('span', { className: "text-2xl mb-1" }, "âž•"), e('span', { className: "text-xs font-medium text-slate-600 font-bangla" }, "à¦ªà§‹à¦¸à§à¦Ÿ à¦•à¦°à§à¦¨")
                        ),
                        e('button', { onClick: () => setPage('jobs'), className: "flex flex-col items-center justify-center p-4 bg-slate-50 rounded-xl hover:bg-brand-50 transition-colors" },
                            e('span', { className: "text-2xl mb-1" }, "ðŸ”"), e('span', { className: "text-xs font-medium text-slate-600 font-bangla" }, "à¦œà¦¬ à¦–à§à¦à¦œà§à¦¨")
                        ),
                        e('button', { onClick: () => setPage('reports'), className: "flex flex-col items-center justify-center p-4 bg-slate-50 rounded-xl hover:bg-brand-50 transition-colors" },
                            e('span', { className: "text-2xl mb-1" }, "ðŸš©"), e('span', { className: "text-xs font-medium text-slate-600 font-bangla" }, "à¦°à¦¿à¦ªà§‹à¦°à§à¦Ÿ")
                        ),
                        e('button', { onClick: () => setPage('about'), className: "flex flex-col items-center justify-center p-4 bg-slate-50 rounded-xl hover:bg-brand-50 transition-colors" },
                            e('span', { className: "text-2xl mb-1" }, "â„¹ï¸"), e('span', { className: "text-xs font-medium text-slate-600 font-bangla" }, "à¦¸à¦¾à¦¹à¦¾à¦¯à§à¦¯")
                        )
                    )
                )
            );
        };

        // --- Content Area Router ---
        const ContentArea = ({ page, user, setPage }) => {
            const isAdmin = user?.email === ADMIN_EMAIL || user?.user_metadata?.role === 'super_admin';
            
            if (page === 'dash') return e(Dashboard, { user, setPage });
            if (page === 'jobs') return e(JobList, { title: "Available Jobs", filter: 'approved', user });
            if (page === 'reports') return e(ReportList, { user });
            if (page === 'about') return e(AboutPage);
            if (page === 'add_job') return e(AddJobForm, { user, isAdmin });
            if (page === 'my_jobs') return e(JobList, { title: "My Posted Jobs", filter: 'my_posts', user });
            if (isAdmin && page === 'approvals') return e(JobList, { title: "Pending Approvals", filter: 'pending', isAdmin: true, user });
            if (isAdmin && page === 'manage_all') return e(JobList, { title: "Manage All Jobs", filter: 'all', isAdmin: true, user });
            
            return e('div', null, e('h1', null, "Page not found"));
        };

        // --- Main App ---
        const App = () => {
            const [user, setUser] = React.useState(null);
            const [view, setView] = React.useState('loading');
            const [page, setPage] = React.useState('dash');
            const [sidebarOpen, setSidebarOpen] = React.useState(false);

            React.useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    setUser(session?.user ?? null); 
                    setView(session?.user ? 'app' : 'login');
                });
                const { data: { subscription } } = supabase.auth.onAuthStateChange((e, s) => {
                    setUser(s?.user ?? null);
                    setView(s?.user ? 'app' : 'login');
                });
                return () => subscription.unsubscribe();
            }, []);

            if (view === 'loading') return e('div', { className: "flex h-screen items-center justify-center bg-slate-50" }, e('div', { className: "loader" }));
            if (view === 'login') return e(AuthScreen, { type: 'login', onSwitch: setView, onSuccess: () => setView('app') });
            if (view === 'register') return e(AuthScreen, { type: 'register', onSwitch: setView });

            return e('div', { className: "flex min-h-screen bg-slate-50" },
                sidebarOpen && e('div', { onClick: () => setSidebarOpen(false), className: "fixed inset-0 z-30 bg-black/50 backdrop-blur-sm md:hidden" }),
                
                e(Sidebar, { page, setPage, onLogout: () => supabase.auth.signOut(), role: user?.user_metadata?.role, isOpen: sidebarOpen, setIsOpen: setSidebarOpen, userEmail: user.email }),
                
                e('div', { className: "flex-1 flex flex-col w-full md:ml-0 min-h-screen" },
                    e('div', { className: "md:hidden sticky top-0 z-20 bg-white/90 backdrop-blur-lg border-b p-4 flex items-center justify-between shadow-sm" },
                        e('button', { onClick: () => setSidebarOpen(true), className: "p-2 rounded-lg hover:bg-slate-100 text-slate-600" }, "â˜°"),
                        e('span', { className: "font-bold text-lg text-brand-700" }, "BRITN"),
                        e('div', { className: "w-8" })
                    ),
                    
                    e('div', { className: "flex-1 p-6 md:p-8 overflow-auto" },
                        e(ContentArea, { page, user, setPage })
                    )
                )
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(e(App));
    </script>
</body>
</html>
