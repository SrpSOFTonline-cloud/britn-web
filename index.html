<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRITN - Login & Register</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 500: '#0066CC', 600: '#0052A3' },
                        accent: { 500: '#00B894' }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8FAFC; margin: 0; }
    </style>
</head>
<body>
    <div id="root" style="min-height: 100vh;"></div>

    <!-- React & Supabase CDN -->
    <script type="module">
        import React from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

        // --- Configuration ---
        const SUPABASE_URL = 'https://hosiwwylofzjtweclycv.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhvc2l3d3lsb2Z6anR3ZWNseWN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2NTc3ODgsImV4cCI6MjA4NzIzMzc4OH0.DkCioDXAQQYZm9NOhfsyuXvArR1TQjMMRf7OFv8FClA';
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- Components ---

        // 1. Login Component
        const LoginPage = ({ onSwitch, onLogin }) => {
            const [email, setEmail] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [loading, setLoading] = React.useState(false);
            const [error, setError] = React.useState(null);

            const handleLogin = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError(null);
                
                const { error } = await supabase.auth.signInWithPassword({ email, password });
                
                if (error) {
                    setError(error.message);
                    setLoading(false);
                } else {
                    onLogin(); // Switch to Dashboard
                }
            };

            return React.createElement('div', { className: "min-h-screen flex items-center justify-center bg-slate-50 p-4" },
                React.createElement('div', { className: "bg-white p-8 rounded-2xl shadow-lg w-full max-w-md" },
                    React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-6 text-center" }, "Login to BRITN"),
                    
                    error && React.createElement('div', { className: "bg-red-100 text-red-600 p-3 rounded-lg mb-4 text-sm" }, error),

                    React.createElement('form', { onSubmit: handleLogin, className: "space-y-4" },
                        React.createElement('input', { 
                            type: "email", placeholder: "Email", required: true, value: email,
                            onChange: (e) => setEmail(e.target.value),
                            className: "w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary-500 outline-none"
                        }),
                        React.createElement('input', { 
                            type: "password", placeholder: "Password", required: true, value: password,
                            onChange: (e) => setPassword(e.target.value),
                            className: "w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary-500 outline-none"
                        }),
                        React.createElement('button', { 
                            type: "submit", disabled: loading,
                            className: "w-full py-3 bg-primary-500 text-white rounded-lg font-semibold hover:bg-primary-600 disabled:opacity-50"
                        }, loading ? "Logging in..." : "Login")
                    ),

                    React.createElement('p', { className: "mt-4 text-center text-gray-500 text-sm" },
                        "Don't have an account? ",
                        React.createElement('button', { onClick: onSwitch, className: "text-primary-500 font-semibold hover:underline" }, "Register")
                    )
                )
            );
        };

        // 2. Register Component
        const RegisterPage = ({ onSwitch, onLogin }) => {
            const [formData, setFormData] = React.useState({ fullName: '', email: '', password: '', role: 'student' });
            const [loading, setLoading] = React.useState(false);
            const [message, setMessage] = React.useState(null);

            const handleChange = (e) => setFormData({ ...formData, [e.target.name]: e.target.value });

            const handleRegister = async (e) => {
                e.preventDefault();
                setLoading(true);
                
                const { data, error } = await supabase.auth.signUp({
                    email: formData.email,
                    password: formData.password,
                    options: {
                        data: { full_name: formData.fullName, role: formData.role }
                    }
                });

                setLoading(false);
                if (error) {
                    setMessage(error.message);
                } else {
                    setMessage("Registration successful! Redirecting...");
                    setTimeout(() => onLogin(), 1500);
                }
            };

            return React.createElement('div', { className: "min-h-screen flex items-center justify-center bg-slate-50 p-4" },
                React.createElement('div', { className: "bg-white p-8 rounded-2xl shadow-lg w-full max-w-md" },
                    React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-6 text-center" }, "Create Account"),

                    message && React.createElement('div', { className: "bg-green-100 text-green-600 p-3 rounded-lg mb-4 text-sm" }, message),

                    React.createElement('form', { onSubmit: handleRegister, className: "space-y-4" },
                        React.createElement('input', { name: "fullName", placeholder: "Full Name", required: true, onChange: handleChange, className: "w-full px-4 py-3 border rounded-lg" }),
                        React.createElement('input', { name: "email", type: "email", placeholder: "Email", required: true, onChange: handleChange, className: "w-full px-4 py-3 border rounded-lg" }),
                        React.createElement('input', { name: "password", type: "password", placeholder: "Password", required: true, onChange: handleChange, className: "w-full px-4 py-3 border rounded-lg" }),
                        React.createElement('select', { name: "role", onChange: handleChange, className: "w-full px-4 py-3 border rounded-lg bg-white" },
                            React.createElement('option', { value: "student" }, "Student"),
                            React.createElement('option', { value: "technologist" }, "Technologist"),
                            React.createElement('option', { value: "hospital" }, "Hospital")
                        ),
                        React.createElement('button', { type: "submit", disabled: loading, className: "w-full py-3 bg-accent-500 text-white rounded-lg font-semibold hover:bg-green-600" }, loading ? "Registering..." : "Register")
                    ),

                    React.createElement('p', { className: "mt-4 text-center text-gray-500 text-sm" },
                        "Already have an account? ",
                        React.createElement('button', { onClick: onSwitch, className: "text-primary-500 font-semibold hover:underline" }, "Login")
                    )
                )
            );
        };

        // 3. Dashboard Component (After Login)
        const Dashboard = ({ user, onLogout }) => {
            return React.createElement('div', { className: "min-h-screen bg-slate-50 p-8" },
                React.createElement('div', { className: "max-w-4xl mx-auto bg-white p-8 rounded-xl shadow" },
                    React.createElement('h1', { className: "text-2xl font-bold text-gray-800 mb-4" }, "Dashboard"),
                    React.createElement('p', { className: "text-gray-600 mb-2" }, `Welcome, ${user?.email || 'User'}!`),
                    React.createElement('div', { className: "bg-green-100 text-green-700 p-4 rounded-lg mb-6" }, "âœ… Successfully Logged In & Database Connected!"),
                    React.createElement('button', { onClick: onLogout, className: "px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600" }, "Logout")
                )
            );
        };

        // 4. Main App Controller
        const App = () => {
            const [view, setView] = React.useState('home'); // home, login, register, dashboard
            const [user, setUser] = React.useState(null);

            // Check session on load
            React.useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    if (session) {
                        setUser(session.user);
                        setView('dashboard');
                    }
                });
                
                // Listen for auth changes
                const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {
                    if (session) {
                        setUser(session.user);
                        setView('dashboard');
                    } else {
                        setUser(null);
                        setView('home');
                    }
                });

                return () => subscription.unsubscribe();
            }, []);

            const handleLogout = async () => {
                await supabase.auth.signOut();
                setUser(null);
                setView('home');
            };

            // Simple Routing Logic
            if (view === 'dashboard' && user) return React.createElement(Dashboard, { user, onLogout: handleLogout });
            if (view === 'login') return React.createElement(LoginPage, { onSwitch: () => setView('register'), onLogin: () => setView('dashboard') });
            if (view === 'register') return React.createElement(RegisterPage, { onSwitch: () => setView('login'), onLogin: () => setView('dashboard') });

            // Home View
            return React.createElement('div', { className: "min-h-screen bg-slate-50 flex flex-col items-center justify-center p-8 text-center" },
                React.createElement('div', { className: "w-20 h-20 bg-primary-500 rounded-2xl flex items-center justify-center text-white text-4xl font-bold mb-6 shadow-lg" }, "B"),
                React.createElement('h1', { className: "text-4xl font-bold text-gray-800 mb-2" }, "Welcome to BRITN"),
                React.createElement('p', { className: "text-gray-500 mb-8" }, "Bangladesh Radiology & Imaging Techanologist Network"),
                React.createElement('div', { className: "flex space-x-4" },
                    React.createElement('button', { onClick: () => setView('login'), className: "px-6 py-3 bg-primary-500 text-white rounded-lg font-semibold hover:bg-primary-600" }, "Login"),
                    React.createElement('button', { onClick: () => setView('register'), className: "px-6 py-3 bg-white border text-gray-700 rounded-lg font-semibold hover:bg-gray-50" }, "Register")
                )
            );
        };

        // Render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
