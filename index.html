<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRITN - Professional Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 500: '#0066CC', 600: '#0052A3', 100: '#DBEAFE' },
                        accent: { 500: '#00B894' },
                        danger: { 500: '#EF4444' }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F1F5F9; margin: 0; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #0066CC; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .star { cursor: pointer; font-size: 1.5rem; color: #cbd5e1; }
        .star.active { color: #fbbf24; }
        /* Sidebar Transition */
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
    </style>
</head>
<body>
    <div id="root" style="height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div class="loader"></div>
    </div>

    <script type="module">
        import React from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

        // --- CONFIGURATION ---
        const BRITN_LOGO_URL = 'https://z-cdn-media.chatglm.cn/files/947017d9-2ded-4447-ab50-1dfd8ce35fcd.jpg?auth_key=1871748799-320010bf4fcc40a98d5d6172607e7c73-0-134513578fae2800da62ba56df7d4c44';
        
        // à¦ªà§‡à¦®à§‡à¦¨à§à¦Ÿ à¦²à§‹à¦—à§‹à¦° à¦²à¦¿à¦‚à¦• (à¦¬à¦¿à¦•à¦¾à¦¶ à¦“ à¦¨à¦—à¦¦)
        const BKASH_LOGO = 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/BKash_Logo_icon.svg/1200px-BKash_Logo_icon.svg.png';
        const NAGAD_LOGO = 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Nagad-Logo.wine.svg/1200px-Nagad-Logo.wine.svg.png';
        
        const DONATION_NUMBER = '01843860547';
        const SUPABASE_URL = 'https://hosiwwylofzjtweclycv.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhvc2l3d3lsb2Z6anR3ZWNseWN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2NTc3ODgsImV4cCI6MjA4NzIzMzc4OH0.DkCioDXAQQYZm9NOhfsyuXvArR1TQjMMRf7OFv8FClA';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
        
        const ADMIN_EMAIL = 'admin@britn.com';
        const e = React.createElement;

        const safeFetch = async (query) => {
            try {
                const { data, error } = await query;
                if (error) throw error;
                return data || [];
            } catch (err) { console.error("Fetch Error:", err); return []; }
        };

        // --- Auth Screen ---
        const AuthScreen = ({ type, onSwitch, onSuccess }) => {
            const [form, setForm] = React.useState({ email: '', pass: '', name: '', role: 'student' });
            const [error, setError] = React.useState('');
            
            const handleAuth = async (ev) => {
                ev.preventDefault(); setError('');
                try {
                    if (type === 'login') {
                        const { error } = await supabase.auth.signInWithPassword({ email: form.email, password: form.pass });
                        if (error) throw error;
                        onSuccess();
                    } else {
                        if (form.email === ADMIN_EMAIL) throw new Error("Cannot register with Admin Email.");
                        const { error } = await supabase.auth.signUp({
                            email: form.email, password: form.pass,
                            options: { data: { full_name: form.name, role: form.role } }
                        });
                        if (error) throw error;
                        alert("Registered! Please login.");
                    }
                } catch (err) { setError(err.message); }
            };

            return e('div', { className: "min-h-screen flex items-center justify-center bg-slate-100 p-4" },
                e('div', { className: "bg-white p-6 md:p-8 rounded-2xl shadow-xl w-full max-w-md border" },
                    e('div', { className: "text-center mb-6" },
                        e('img', { src: BRITN_LOGO_URL, alt: "Logo", className: "w-20 h-20 object-contain mx-auto mb-3 rounded-xl" }),
                        e('h2', { className: "text-xl md:text-2xl font-bold" }, type === 'login' ? "Login" : "Register")
                    ),
                    error && e('div', { className: "bg-red-100 text-red-600 p-2 rounded mb-3 text-sm" }, error),
                    e('form', { onSubmit: handleAuth, className: "space-y-3" },
                        type === 'register' && e('input', { placeholder: "Full Name", onChange: (ev) => setForm({...form, name: ev.target.value}), className: "w-full px-3 py-2 border rounded-lg text-sm", required: true }),
                        e('input', { type: "email", placeholder: "Email", value: form.email, onChange: (ev) => setForm({...form, email: ev.target.value}), className: "w-full px-3 py-2 border rounded-lg text-sm", required: true }),
                        e('input', { type: "password", placeholder: "Password", value: form.pass, onChange: (ev) => setForm({...form, pass: ev.target.value}), className: "w-full px-3 py-2 border rounded-lg text-sm", required: true }),
                        type === 'register' && e('select', { onChange: (ev) => setForm({...form, role: ev.target.value}), className: "w-full px-3 py-2 border rounded-lg bg-white text-sm" },
                            e('option', { value: "student" }, "Student"),
                            e('option', { value: "technologist" }, "Technologist"),
                            e('option', { value: "hospital" }, "Hospital")
                        ),
                        e('button', { type: "submit", className: "w-full py-2 bg-primary-500 text-white rounded-lg font-semibold text-sm" }, type === 'login' ? "Login" : "Register")
                    ),
                    e('p', { className: "mt-4 text-center text-xs md:text-sm text-gray-500" },
                        type === 'login' ? "No account? " : "Have account? ",
                        e('button', { type: "button", onClick: () => onSwitch(type === 'login' ? 'register' : 'login'), className: "text-primary-500 font-semibold" }, type === 'login' ? "Register" : "Login")
                    )
                )
            );
        };

        // --- Sidebar (Mobile Ready) ---
        const Sidebar = ({ page, setPage, onLogout, role, isOpen, setIsOpen }) => {
            const isAdmin = role === 'super_admin';
            const canPost = role === 'hospital' || role === 'technologist';
            
            const menus = [
                { id: 'dash', name: 'Dashboard', icon: 'ðŸ ' },
                { id: 'jobs', name: 'Job Portal', icon: 'ðŸ’¼' },
                { id: 'reports', name: 'Report List', icon: 'ðŸš©' },
                { id: 'about', name: 'About', icon: 'â„¹ï¸' },
            ];
            const posterMenus = [ { id: 'add_job', name: 'Post Job', icon: 'âž•' }, { id: 'my_jobs', name: 'My Jobs', icon: 'ðŸ“' } ];
            const adminMenus = [ { id: 'approvals', name: 'Approve', icon: 'âœ…' }, { id: 'manage_all', name: 'Manage', icon: 'ðŸ—‘ï¸' } ];

            const handleNav = (id) => { setPage(id); setIsOpen(false); };

            // Sidebar Classes for Mobile/Desktop
            const sidebarClass = `fixed inset-y-0 left-0 z-40 w-64 bg-white border-r shadow-sm transform sidebar-transition 
                ${isOpen ? 'translate-x-0' : '-translate-x-full'} 
                md:translate-x-0 md:static md:shadow-none`; // Translate off-screen on mobile, static on desktop

            return e('div', { className: sidebarClass },
                // Logo Section
                e('div', { className: "p-4 border-b flex items-center justify-between" },
                    e('div', { className: "flex items-center space-x-2" },
                        e('img', { src: BRITN_LOGO_URL, className: "w-8 h-8 object-contain rounded" }),
                        e('span', { className: "font-bold text-lg hidden md:block" }, "BRITN")
                    ),
                    // Close button for mobile
                    e('button', { onClick: () => setIsOpen(false), className: "md:hidden text-gray-500" }, "âœ•")
                ),
                
                // Navigation
                e('nav', { className: "flex-1 p-2 space-y-1 overflow-y-auto" },
                    menus.map(m => 
                        e('button', { key: m.id, onClick: () => handleNav(m.id), className: `w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-sm ${page === m.id ? 'bg-primary-100 text-primary-600' : 'text-gray-500 hover:bg-slate-50'}` },
                            e('span', null, m.icon), e('span', null, m.name)
                        )
                    ),
                    canPost && e('div', {className: "mt-2 pt-2 border-t"}, 
                        e('p', {className: "px-3 text-xs text-gray-400 mb-1"}, "TOOLS"),
                        posterMenus.map(m => 
                            e('button', { key: m.id, onClick: () => handleNav(m.id), className: `w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-sm ${page === m.id ? 'bg-blue-100 text-blue-600' : 'text-gray-500'}` },
                                e('span', null, m.icon), e('span', null, m.name)
                            )
                        )
                    ),
                    isAdmin && e('div', {className: "mt-2 pt-2 border-t"}, 
                        e('p', {className: "px-3 text-xs text-gray-400 mb-1"}, "ADMIN"),
                        adminMenus.map(m => 
                            e('button', { key: m.id, onClick: () => handleNav(m.id), className: `w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-sm ${page === m.id ? 'bg-red-100 text-red-600' : 'text-gray-500'}` },
                                e('span', null, m.icon), e('span', null, m.name)
                            )
                        )
                    )
                ),
                e('div', { className: "p-2 border-t" },
                    e('button', { onClick: onLogout, className: "w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-red-500 text-sm" }, 
                        e('span', null, 'ðŸšª'), e('span', null, "Logout")
                    )
                )
            );
        };

        // --- About Page with Logos ---
        const AboutPage = () => {
            return e('div', { className: "space-y-4" },
                e('div', { className: "bg-white p-4 rounded-xl shadow-sm border text-center" },
                    e('img', { src: BRITN_LOGO_URL, className: "w-20 h-20 mx-auto mb-2 object-contain" }),
                    e('h1', { className: "text-lg font-bold text-gray-800" }, "Bangladesh Radiology Network"),
                    e('p', { className: "text-gray-500 text-xs" }, "Connecting Professionals")
                ),

                // Donation Section
                e('div', { className: "bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-xl border border-blue-100" },
                    e('h2', { className: "text-lg font-bold text-gray-800 mb-2 flex items-center" }, "â¤ï¸ Support Maintenance"),
                    e('p', { className: "text-gray-600 text-xs mb-3" }, "Help us keep the platform running."),
                    e('div', { className: "grid grid-cols-2 gap-3" },
                        // Bkash Card
                        e('div', { className: "bg-white p-3 rounded-lg border flex flex-col items-center justify-center" },
                            e('img', { src: BKASH_LOGO, className: "h-8 object-contain mb-1", alt: "Bkash Logo" }),
                            e('span', { className: "text-lg font-bold text-gray-800 tracking-wider" }, DONATION_NUMBER),
                            e('button', { onClick: () => navigator.clipboard.writeText(DONATION_NUMBER), className: "mt-1 px-2 py-0.5 bg-pink-500 text-white text-xs rounded" }, "Copy")
                        ),
                        // Nagad Card
                        e('div', { className: "bg-white p-3 rounded-lg border flex flex-col items-center justify-center" },
                            e('img', { src: NAGAD_LOGO, className: "h-8 object-contain mb-1", alt: "Nagad Logo" }),
                            e('span', { className: "text-lg font-bold text-gray-800 tracking-wider" }, DONATION_NUMBER),
                            e('button', { onClick: () => navigator.clipboard.writeText(DONATION_NUMBER), className: "mt-1 px-2 py-0.5 bg-orange-500 text-white text-xs rounded" }, "Copy")
                        )
                    )
                ),
                e('div', { className: "bg-white p-4 rounded-xl shadow-sm border text-xs text-gray-600" },
                    e('h2', { className: "font-bold text-gray-800 mb-2 text-sm" }, "ðŸ“œ Privacy Policy"),
                    e('p', null, "We collect data to verify identity. We do not sell data. Secured via SSL.")
                )
            );
        };

        // --- Report List ---
        const ReportList = ({ user }) => {
            const [reports, setReports] = React.useState([]);
            const [form, setForm] = React.useState({ hospital_name: '', category: 'Bad Behavior', details: '' });
            const [msg, setMsg] = React.useState('');

            const fetchReports = async () => {
                const data = await safeFetch(supabase.from('hospital_reports').select('*').order('created_at', { ascending: false }).limit(20));
                setReports(data);
            };
            React.useEffect(() => { fetchReports(); }, []);

            const handleSubmit = async (ev) => {
                ev.preventDefault();
                if(!form.hospital_name || !form.details) { setMsg("Fill all fields"); return; }
                const { error } = await supabase.from('hospital_reports').insert([{...form, reporter_email: user?.email || 'Anonymous'}]);
                if(error) setMsg("Error: " + error.message);
                else { setMsg("Submitted!"); setForm({ hospital_name: '', category: 'Bad Behavior', details: '' }); fetchReports(); }
            };

            return e('div', null,
                e('h2', { className: "text-lg font-bold mb-3" }, "ðŸš© Report List"),
                e('div', { className: "bg-white p-3 rounded-xl shadow-sm border mb-4" },
                    e('form', { onSubmit: handleSubmit, className: "space-y-2" },
                        e('input', { placeholder: "Hospital Name", value: form.hospital_name, onChange: (e) => setForm({...form, hospital_name: e.target.value}), className: "w-full px-2 py-1.5 border rounded text-xs" }),
                        e('select', { value: form.category, onChange: (e) => setForm({...form, category: e.target.value}), className: "w-full px-2 py-1.5 border rounded text-xs bg-white" },
                            e('option', { value: "Bad Behavior" }, "Bad Behavior"),
                            e('option', { value: "Salary Issue" }, "Salary Issue")
                        ),
                        e('textarea', { placeholder: "Details...", value: form.details, onChange: (e) => setForm({...form, details: e.target.value}), className: "w-full px-2 py-1.5 border rounded text-xs", rows: 2 }),
                        e('button', { className: "px-3 py-1 bg-red-500 text-white rounded text-xs" }, "Submit")
                    )
                ),
                e('div', { className: "space-y-2" }, reports.map(r => 
                    e('div', { key: r.id, className: "bg-white p-2 rounded-lg border text-xs" },
                        e('div', { className: "flex justify-between" }, e('span', {className: "font-bold"}, r.hospital_name), e('span', {className: "text-yellow-600"}, r.category)),
                        e('p', { className: "text-gray-500 mt-1" }, r.details)
                    )
                ))
            );
        };

        // --- Job List ---
        const JobList = ({ title, filter, isAdmin, user }) => {
            const [jobs, setJobs] = React.useState([]);
            const [loading, setLoading] = React.useState(true);

            const fetchJobs = async () => {
                setLoading(true);
                let query = supabase.from('jobs').select('*');
                if (filter === 'pending') query = query.eq('is_approved', false);
                else if (filter === 'approved') query = query.eq('is_approved', true);
                const data = await safeFetch(query.order('created_at', { ascending: false }).limit(20));
                setJobs(data); setLoading(false);
            };
            React.useEffect(() => { fetchJobs(); }, []);

            const handleAction = async (id, action) => {
                if (!confirm("Sure?")) return;
                if (action === 'delete') await supabase.from('jobs').delete().eq('id', id);
                if (action === 'approve') await supabase.from('jobs').update({ is_approved: true }).eq('id', id);
                fetchJobs();
            };

            if (loading) return e('p', {className: "text-xs text-gray-400"}, "Loading...");

            return e('div', null,
                e('h2', { className: "text-lg font-bold mb-3" }, title),
                e('div', { className: "space-y-2" }, jobs.map(job => 
                    e('div', { key: job.id, className: "bg-white p-3 rounded-lg border shadow-sm" },
                        e('div', { className: "flex justify-between items-start" },
                            e('div', null,
                                e('h3', { className: "font-bold text-sm text-gray-800" }, job.title),
                                e('p', { className: "text-xs text-gray-500 mt-0.5" }, `ðŸ“ ${job.location} | ðŸ’° ${job.salary || 'N/A'}`),
                                !job.is_approved && e('span', { className: "text-xs text-yellow-600" }, "(Pending)")
                            ),
                            e('div', { className: "flex space-x-1" },
                                isAdmin && !job.is_approved && e('button', { onClick: () => handleAction(job.id, 'approve'), className: "px-2 py-0.5 bg-green-500 text-white text-xs rounded" }, "Approve"),
                                isAdmin && e('button', { onClick: () => handleAction(job.id, 'delete'), className: "px-2 py-0.5 bg-red-500 text-white text-xs rounded" }, "Del")
                            )
                        )
                    )
                ))
            );
        };

        const AddJobForm = ({ isAdmin }) => {
            const [form, setForm] = React.useState({ title: '', location: '', salary: '', description: '' });
            const [msg, setMsg] = React.useState('');

            const handleSubmit = async (ev) => {
                ev.preventDefault();
                const { error } = await supabase.from('jobs').insert([{...form, is_approved: isAdmin ? true : false}]);
                if (error) setMsg("Error"); else { setMsg("Success!"); setForm({}); }
            };

            return e('div', { className: "bg-white p-4 rounded-xl shadow-sm border" },
                e('h2', { className: "text-lg font-bold mb-3" }, "Post Job"),
                msg && e('div', { className: "p-2 rounded mb-2 text-xs bg-green-100 text-green-600" }, msg),
                e('form', { onSubmit: handleSubmit, className: "space-y-2" },
                    e('input', { placeholder: "Title *", value: form.title, onChange: (e) => setForm({...form, title: e.target.value}), className: "w-full px-2 py-1.5 border rounded text-xs", required: true }),
                    e('input', { placeholder: "Location *", value: form.location, onChange: (e) => setForm({...form, location: e.target.value}), className: "w-full px-2 py-1.5 border rounded text-xs", required: true }),
                    e('input', { placeholder: "Salary", value: form.salary, onChange: (e) => setForm({...form, salary: e.target.value}), className: "w-full px-2 py-1.5 border rounded text-xs" }),
                    e('textarea', { placeholder: "Desc", value: form.description, onChange: (e) => setForm({...form, description: e.target.value}), className: "w-full px-2 py-1.5 border rounded text-xs", rows: 2 }),
                    e('button', { type: "submit", className: "w-full py-1.5 bg-primary-500 text-white rounded text-xs font-semibold" }, "Submit")
                )
            );
        };

        // --- Content Area ---
        const ContentArea = ({ page, user }) => {
            const isAdmin = user?.user_metadata?.role === 'super_admin';
            if (page === 'jobs') return e(JobList, { title: "Jobs", filter: 'approved', user });
            if (page === 'reports') return e(ReportList, { user });
            if (page === 'about') return e(AboutPage);
            if (page === 'add_job') return e(AddJobForm, { isAdmin });
            if (page === 'my_jobs') return e(JobList, { title: "My Jobs", filter: 'all' });
            if (isAdmin && page === 'approvals') return e(JobList, { title: "Approvals", filter: 'pending', isAdmin: true });
            if (isAdmin && page === 'manage_all') return e(JobList, { title: "Manage", filter: 'all', isAdmin: true });
            return e('div', null, 
                e('h1', { className: "text-lg font-bold" }, "Dashboard"),
                e('p', { className: "text-gray-500 text-xs mt-1" }, `Role: ${user?.user_metadata?.role}`)
            );
        };

        // --- Main App ---
        const App = () => {
            const [user, setUser] = React.useState(null);
            const [view, setView] = React.useState('loading');
            const [page, setPage] = React.useState('dash');
            const [sidebarOpen, setSidebarOpen] = React.useState(false); // For mobile toggle

            React.useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    setUser(session?.user ?? null); 
                    setView(session?.user ? 'app' : 'login');
                });
                const { data: { subscription } } = supabase.auth.onAuthStateChange((e, s) => {
                    setUser(s?.user ?? null);
                    setView(s?.user ? 'app' : 'login');
                });
                return () => subscription.unsubscribe();
            }, []);

            if (view === 'loading') return e('div', { className: "flex h-screen items-center justify-center" }, e('div', { className: "loader" }));
            if (view === 'login') return e(AuthScreen, { type: 'login', onSwitch: setView, onSuccess: () => setView('app') });
            if (view === 'register') return e(AuthScreen, { type: 'register', onSwitch: setView });

            return e('div', { className: "flex min-h-screen bg-slate-100" },
                // Overlay for mobile
                sidebarOpen && e('div', { onClick: () => setSidebarOpen(false), className: "fixed inset-0 z-30 bg-black opacity-50 md:hidden" }),
                
                // Sidebar
                e(Sidebar, { page, setPage, onLogout: () => supabase.auth.signOut(), role: user?.user_metadata?.role, isOpen: sidebarOpen, setIsOpen: setSidebarOpen }),
                
                // Main Content Area
                e('div', { className: "flex-1 flex flex-col w-full md:ml-0" }, // No margin left on mobile, sidebar is overlay
                    // Mobile Top Bar
                    e('div', { className: "md:hidden sticky top-0 z-20 bg-white border-b p-2 flex items-center justify-between" },
                        e('button', { onClick: () => setSidebarOpen(true), className: "p-2 rounded hover:bg-slate-100" }, "â˜°"),
                        e('span', { className: "font-bold text-primary-500" }, "BRITN"),
                        e('div', { className: "w-8" }) // Spacer
                    ),
                    
                    // Content
                    e('div', { className: "flex-1 p-4 md:p-6 overflow-auto" },
                        e(ContentArea, { page, user })
                    )
                )
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(e(App));
    </script>
</body>
</html>
