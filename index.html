<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BRITN - Professional Network</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0A66C2',
                        'primary-dark': '#004182',
                        'bg-grey': '#F3F2EF',
                        'text-dark': '#1D1D1D',
                        'text-grey': '#666666',
                        'border-grey': '#E0E0E0',
                        'gold': '#FFD700',
                        'success': '#057642',
                        'danger': '#D11124',
                    }
                }
            }
        }
    </script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #F3F2EF;
            margin: 0; 
            color: #1D1D1D;
            -webkit-font-smoothing: antialiased;
        }
        .font-bangla { font-family: 'Hind Siliguri', sans-serif; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 10px; }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-up { animation: slideUp 0.4s ease-out forwards; }

        /* Input Focus */
        .input-focus:focus {
            border-color: #0A66C2;
            box-shadow: 0 0 0 1px #0A66C2;
        }

        /* Verified Badge */
        .verified-badge { 
            background: linear-gradient(135deg, #FFD700, #FFA500); 
            color: #1D1D1D; 
            padding: 2px 6px; 
            border-radius: 4px; 
            font-size: 9px; 
            font-weight: 800; 
            display: inline-flex;
            align-items: center;
            gap: 3px;
            margin-left: 6px;
        }
        
        /* Ripple Effect */
        .ripple { position: relative; overflow: hidden; }
        .ripple:after {
            content: "";
            display: block;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
            background-repeat: no-repeat;
            background-position: 50%;
            transform: scale(10, 10);
            opacity: 0;
            transition: transform .4s, opacity .8s;
        }
        .ripple:active:after {
            transform: scale(0, 0);
            opacity: .2;
            transition: 0s;
        }

        /* Smart Layout for Reports */
        .report-card {
            background: white;
            border: 1px solid #E0E0E0;
            transition: all 0.2s;
        }
        .report-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transform: translateY(-1px);
        }

        /* Category Chip */
        .chip {
            padding: 6px 12px;
            border: 1px solid #E0E0E0;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }
        .chip.active {
            background: #0A66C2;
            color: white;
            border-color: #0A66C2;
            font-weight: 600;
        }
        .chip:not(.active):hover {
            background: #F3F2EF;
        }
    </style>
</head>
<body>
    <div id="root" style="height: 100vh; display: flex; align-items: center; justify-content: center; background: #F3F2EF;">
        <div class="w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
    </div>

    <script type="module">
        import React from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

        // --- CONFIGURATION ---
        const BRITN_LOGO_URL = 'https://z-cdn-media.chatglm.cn/files/947017d9-2ded-4447-ab50-1dfd8ce35fcd.jpg?auth_key=1871748799-320010bf4fcc40a98d5d6172607e7c73-0-134513578fae2800da62ba56df7d4c44';
        const SUPABASE_URL = 'https://hosiwwylofzjtweclycv.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhvc2l3d3lsb2Z6anR3ZWNseWN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2NTc3ODgsImV4cCI6MjA4NzIzMzc4OH0.DkCioDXAQQYZm9NOhfsyuXvArR1TQjMMRf7OFv8FClA';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
        
        const ADMIN_EMAIL = 'admin@britn.com';
        const e = React.createElement;

        // --- Helpers ---
        const safeFetch = async (query) => {
            try { const { data, error } = await query; if (error) throw error; return data || []; } 
            catch (err) { console.error("Fetch Error:", err); return []; }
        };

        // --- Toast Context ---
        const ToastContext = React.createContext();
        const useToast = () => React.useContext(ToastContext);
        
        const ToastProvider = ({ children }) => {
            const [toasts, setToasts] = React.useState([]);
            const addToast = (message, type = 'success') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type }]);
                setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 3000);
            };
            return e(ToastContext.Provider, { value: addToast }, 
                children,
                e('div', { className: "fixed top-5 right-5 z-[9999] flex flex-col gap-2" }, 
                    toasts.map(t => e('div', { 
                        key: t.id, 
                        className: `px-4 py-2 rounded-lg shadow-lg text-white text-sm font-medium fade-in ${t.type === 'success' ? 'bg-success' : 'bg-danger'}`
                    }, t.message))
                )
            );
        };

        // --- Skeleton ---
        const CardSkeleton = () => e('div', { className: "bg-white rounded-lg border border-border-grey p-4 space-y-3" },
            e('div', { className: "flex gap-3" },
                e('div', { className: "w-10 h-10 rounded-full bg-gray-200 animate-pulse" }),
                e('div', { className: "flex-1 space-y-2" },
                    e('div', { className: "h-3 w-3/4 rounded bg-gray-200 animate-pulse" }),
                    e('div', { className: "h-2 w-1/2 rounded bg-gray-200 animate-pulse" })
                )
            )
        );

        // --- Auth Screen (Condensed for brevity - same logic as before) ---
        const AuthScreen = ({ type, onSwitch, onSuccess }) => {
            const [form, setForm] = React.useState({ email: '', pass: '', name: '', role: 'student' });
            const [error, setError] = React.useState('');
            const [loading, setLoading] = React.useState(false);
            
            const handleAuth = async (ev) => {
                ev.preventDefault(); setError(''); setLoading(true);
                try {
                    if (type === 'login') {
                        const { error } = await supabase.auth.signInWithPassword({ email: form.email, password: form.pass });
                        if (error) throw error; onSuccess();
                    } else {
                        if (form.email === ADMIN_EMAIL) throw new Error("Admin email reserved.");
                        const { error } = await supabase.auth.signUp({
                            email: form.email, password: form.pass,
                            options: { data: { full_name: form.name, role: form.role } }
                        });
                        if (error) throw error;
                        alert("Registered! Please login."); onSwitch('login');
                    }
                } catch (err) { setError(err.message); } finally { setLoading(false); }
            };

            return e('div', { className: "min-h-screen flex items-center justify-center bg-bg-grey p-4" },
                e('div', { className: "w-full max-w-md fade-in" },
                    e('div', { className: "bg-white rounded-xl shadow-md border border-border-grey overflow-hidden" },
                        e('div', { className: "bg-primary p-6 text-center" },
                            e('img', { src: BRITN_LOGO_URL, className: "w-16 h-16 mx-auto rounded-full border-4 border-white/20 mb-2" }),
                            e('h1', { className: "text-xl font-bold text-white" }, "BRITN"),
                            e('p', { className: "text-xs text-white/80 font-bangla" }, "Bangladesh Radiology & Imaging Technologist Network")
                        ),
                        e('div', { className: "p-6" },
                            error && e('div', { className: "bg-red-50 text-danger p-3 rounded-lg mb-4 text-xs text-center font-medium" }, error),
                            e('form', { onSubmit: handleAuth, className: "space-y-4" },
                                type === 'register' && e('div', null, 
                                    e('label', {className: "text-xs font-medium text-text-grey"}, "Full Name"),
                                    e('input', { placeholder: "Full Name", onChange: (ev) => setForm({...form, name: ev.target.value}), className: "mt-1 w-full p-3 border border-border-grey rounded-lg input-focus outline-none text-sm", required: true })
                                ),
                                e('div', null, 
                                    e('label', {className: "text-xs font-medium text-text-grey"}, "Email"),
                                    e('input', { type: "email", placeholder: "Email", value: form.email, onChange: (ev) => setForm({...form, email: ev.target.value}), className: "mt-1 w-full p-3 border border-border-grey rounded-lg input-focus outline-none text-sm", required: true })
                                ),
                                e('div', null, 
                                    e('label', {className: "text-xs font-medium text-text-grey"}, "Password"),
                                    e('input', { type: "password", placeholder: "Password", value: form.pass, onChange: (ev) => setForm({...form, pass: ev.target.value}), className: "mt-1 w-full p-3 border border-border-grey rounded-lg input-focus outline-none text-sm", required: true })
                                ),
                                
                                type === 'register' && e('div', { className: "grid grid-cols-3 gap-2 pt-2" }, 
                                    ['student', 'technologist', 'hospital'].map(r => 
                                        e('button', { type: "button", key: r, onClick: () => setForm({...form, role: r}), 
                                            className: `py-2 rounded-lg text-xs font-semibold transition border ${form.role === r ? 'bg-primary text-white border-primary' : 'bg-white border-border-grey text-text-grey hover:border-primary hover:text-primary'}` 
                                        }, r.charAt(0).toUpperCase() + r.slice(1))
                                    )
                                ),
                                e('button', { type: "submit", disabled: loading, className: "w-full py-3 bg-primary text-white rounded-lg font-bold text-sm hover:bg-primary-dark transition ripple mt-2" }, 
                                    loading ? "Please wait..." : (type === 'login' ? "Sign In" : "Join Network")
                                )
                            ),
                            e('div', { className: "mt-4 text-center text-xs text-text-grey" },
                                type === 'login' ? "New to BRITN? " : "Already a member? ",
                                e('button', { onClick: () => onSwitch(type === 'login' ? 'register' : 'login'), className: "text-primary font-bold hover:underline" }, type === 'login' ? "Join now" : "Sign in")
                            )
                        )
                    )
                )
            );
        };

        // --- Navbar & Sidebar (Same as previous) ---
        const TopNav = ({ user, onLogout }) => {
            return e('header', { className: "sticky top-0 z-50 bg-white border-b border-border-grey shadow-sm hidden md:block" },
                e('div', { className: "max-w-6xl mx-auto px-4 h-16 flex items-center justify-between" },
                    e('div', { className: "flex items-center gap-2" },
                        e('img', { src: BRITN_LOGO_URL, className: "w-9 h-9 rounded-lg" }),
                        e('span', { className: "font-bold text-lg text-primary" }, "BRITN")
                    ),
                    e('div', { className: "flex items-center gap-2" },
                        e('span', { className: "text-xs text-text-grey font-medium" }, user?.email),
                        e('button', { onClick: onLogout, className: "p-2 rounded-full hover:bg-bg-grey text-text-grey hover:text-danger transition" }, "ðŸšª")
                    )
                )
            );
        };

        const BottomNav = ({ page, setPage }) => {
            const items = [ 
                { id: 'dash', icon: 'ðŸ ', label: 'Home' }, 
                { id: 'feed', icon: 'ðŸ“°', label: 'Feed' }, 
                { id: 'jobs', icon: 'ðŸ’¼', label: 'Jobs' }, 
                { id: 'reports', icon: 'ðŸš©', label: 'Report' } 
            ];
            return e('nav', { className: "md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-border-grey z-50" },
                e('div', { className: "flex justify-around items-center h-16" },
                    items.map(item => 
                        e('button', { key: item.id, onClick: () => setPage(item.id), className: `flex flex-col items-center justify-center w-full h-full ${page === item.id ? 'text-primary' : 'text-text-grey'}` },
                            e('span', { className: "text-xl" }, item.icon),
                            e('span', { className: "text-[10px] font-medium mt-0.5" }, item.label)
                        )
                    )
                )
            );
        };

        const LeftSidebar = ({ user }) => {
            return e('div', { className: "hidden md:flex flex-col gap-4 w-64 sticky top-20 h-[calc(100vh-5rem)] overflow-y-auto" },
                e('div', { className: "bg-white rounded-lg border border-border-grey overflow-hidden text-center shadow-sm" },
                    e('div', { className: "h-12 bg-primary" }, null),
                    e('div', { className: "p-4 pt-0" },
                        e('div', { className: "w-14 h-14 mx-auto bg-white rounded-full border-2 border-white -mt-7 flex items-center justify-center text-2xl text-primary font-bold shadow-sm" }, 
                            user?.user_metadata?.full_name?.charAt(0) || "U"
                        ),
                        e('h3', { className: "font-bold text-sm text-text-dark mt-1" }, user?.user_metadata?.full_name || "User"),
                        e('p', { className: "text-xs text-text-grey mt-0.5" }, user?.user_metadata?.role || "Member")
                    )
                )
            );
        };

        const RightSidebar = ({ jobs }) => {
            const recentJobs = jobs?.slice(0, 3) || [];
            return e('div', { className: "hidden lg:block w-72 sticky top-20 h-[calc(100vh-5rem)] overflow-y-auto" },
                e('div', { className: "bg-white rounded-lg border border-border-grey p-4 shadow-sm" },
                    e('h3', { className: "font-bold text-sm text-text-dark mb-2" }, "Latest Jobs"),
                    e('div', { className: "space-y-3" },
                        recentJobs.length === 0 ? e('p', {className: "text-xs text-text-grey"}, "No jobs posted") :
                        recentJobs.map(job => 
                            e('div', { key: job.id, className: "p-2 rounded hover:bg-bg-grey cursor-pointer transition" },
                                e('h4', { className: "text-xs font-semibold text-text-dark truncate" }, job.title),
                                e('p', { className: "text-[10px] text-text-grey truncate" }, job.location)
                            )
                        )
                    )
                )
            );
        };

        // --- REDESIGNED REPORT PAGE ---
        const ReportPage = ({ user }) => {
            const [reports, setReports] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            const [search, setSearch] = React.useState('');
            // Categories updated to match Bengali context
            const categories = ['Bad Behavior', 'Salary Issue', 'Deception', 'Safety Concern', 'Other'];
            const [form, setForm] = React.useState({ hospital_name: '', category: 'Bad Behavior', details: '' });
            const toast = useToast();
            const isAdmin = user?.email === ADMIN_EMAIL;

            const fetch = async () => {
                setLoading(true);
                setReports(await safeFetch(supabase.from('hospital_reports').select('*').order('created_at', { ascending: false }).limit(50)));
                setLoading(false);
            };
            React.useEffect(() => { fetch(); }, []);

            const handleSubmit = async (ev) => {
                ev.preventDefault();
                if(!form.hospital_name || !form.details) return;
                await supabase.from('hospital_reports').insert([{...form, reporter_email: user?.email}]); 
                setForm({ hospital_name: '', category: 'Bad Behavior', details: '' });
                fetch(); 
                toast("Report Submitted Successfully");
            };

            const filtered = reports.filter(r => 
                r.hospital_name.toLowerCase().includes(search.toLowerCase()) ||
                r.details.toLowerCase().includes(search.toLowerCase())
            );

            return e('div', { className: "max-w-3xl mx-auto pb-20 md:pb-4 fade-in" },
                
                // 1. AWARENESS CARD (Why Report?)
                e('div', { className: "bg-white rounded-xl border border-border-grey p-5 mb-4 shadow-sm slide-up" },
                    e('div', { className: "flex items-start gap-4" },
                        e('div', { className: "w-10 h-10 bg-danger/10 rounded-full flex items-center justify-center text-danger flex-shrink-0 text-lg" }, "ðŸ›¡ï¸"),
                        e('div', { className: "font-bangla" },
                            e('h2', { className: "font-bold text-text-dark text-sm" }, "à¦ªà§‡à¦¶à¦¾à¦—à¦¤ à¦…à¦§à¦¿à¦•à¦¾à¦° à¦°à¦•à§à¦·à¦¾ à¦•à¦°à§à¦¨"),
                            e('p', { className: "text-text-grey text-xs leading-relaxed mt-2" }, 
                                "à¦…à¦¨à§‡à¦• à¦œà¦¾à§Ÿà¦—à¦¾à§Ÿ à¦Ÿà§‡à¦•à¦¨à§‹à¦²à¦œà¦¿à¦¸à§à¦Ÿà¦°à¦¾ à¦à¦–à¦¨à§‹ à¦ªà§‡à¦¶à¦¾à¦—à¦¤à¦­à¦¾à¦¬à§‡ à¦…à¦¬à¦¹à§‡à¦²à¦¾à¦° à¦¶à¦¿à¦•à¦¾à¦° à¦¹à¦¨ â— à¦•à§‡à¦‰ à¦šà¦¾à¦•à¦°à¦¿à¦° à¦¸à§à¦¯à§‹à¦—à§‡ à¦¬à¦žà§à¦šà¦¿à¦¤ à¦¹à¦¨, à¦•à§‡à¦‰ à¦–à¦¾à¦°à¦¾à¦ª à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦¸à¦¹à§à¦¯ à¦•à¦°à¦¤à§‡ à¦¬à¦¾à¦§à§à¦¯ à¦¹à¦¨à¥¤"
                            ),
                            e('div', { className: "mt-3 pt-3 border-t border-border-grey space-y-1 text-xs text-text-grey" },
                                e('p', null, "ðŸ‘‰ BRITN à¦ªà§à¦²à§à¦¯à¦¾à¦Ÿà¦«à¦°à§à¦®à§‡ à¦†à¦ªà¦¨à¦¿ à¦°à¦¿à¦ªà§‹à¦°à§à¦Ÿ à¦ªà§‹à¦¸à§à¦Ÿ à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡à¦¨à¥¤"),
                                e('p', null, "ðŸ‘‰ à¦•à§‹à¦¨ à¦¹à¦¾à¦¸à¦ªà¦¾à¦¤à¦¾à¦² à¦¬à¦¾ à¦ªà§à¦°à¦¤à¦¿à¦·à§à¦ à¦¾à¦¨ à¦¯à¦¦à¦¿ à¦–à¦¾à¦°à¦¾à¦ª à¦†à¦šà¦°à¦£ à¦•à¦°à§‡, à¦¤à¦¾ à¦ªà§à¦°à¦•à¦¾à¦¶ à¦•à¦°à¦¾ à¦¯à¦¾à¦¬à§‡à¥¤"),
                                e('p', { className: "text-success font-medium" }, "âœ… à¦‰à¦¦à§à¦¦à§‡à¦¶à§à¦¯ à¦¨à¦¿à¦°à¦¾à¦ªà¦¦ à¦•à¦°à§à¦®à¦ªà¦°à¦¿à¦¬à§‡à¦¶ à¦¤à§ˆà¦°à¦¿à¥¤")
                            )
                        )
                    )
                ),

                // 2. REPORT FORM
                e('div', { className: "bg-white rounded-xl border border-border-grey p-5 mb-4 shadow-sm slide-up", style: { animationDelay: '0.1s' } },
                    e('h3', { className: "font-bold text-text-dark mb-4 flex items-center gap-2" }, 
                        "ðŸ“ Submit Report", 
                        e('span', { className: "text-[10px] font-normal text-text-grey bg-bg-grey px-2 py-0.5 rounded-full" }, "Confidential")
                    ),
                    e('form', { onSubmit: handleSubmit, className: "space-y-4" },
                        // Hospital Name
                        e('div', null,
                            e('label', { className: "text-xs font-semibold text-text-dark block mb-1.5" }, "Hospital / Institution Name"),
                            e('input', { 
                                placeholder: "e.g. Dhaka Medical College", 
                                value: form.hospital_name, 
                                onChange: e => setForm({...form, hospital_name: e.target.value}), 
                                className: "w-full p-3 bg-bg-grey border border-transparent rounded-xl outline-none text-sm hover:border-border-grey focus:border-primary focus:bg-white transition",
                                required: true 
                            })
                        ),

                        // Category Chips
                        e('div', null,
                            e('label', { className: "text-xs font-semibold text-text-dark block mb-1.5" }, "Category"),
                            e('div', { className: "flex flex-wrap gap-2" }, 
                                categories.map(cat => 
                                    e('button', { 
                                        type: "button", 
                                        key: cat, 
                                        onClick: () => setForm({...form, category: cat}), 
                                        className: `chip ${form.category === cat ? 'active' : ''}`
                                    }, cat)
                                )
                            )
                        ),

                        // Details (Large)
                        e('div', null,
                            e('label', { className: "text-xs font-semibold text-text-dark block mb-1.5" }, "What happened?"),
                            e('textarea', { 
                                placeholder: "Describe the issue in detail...", 
                                value: form.details, 
                                onChange: e => setForm({...form, details: e.target.value}), 
                                className: "w-full p-4 bg-bg-grey border border-transparent rounded-xl outline-none min-h-[200px] text-sm hover:border-border-grey focus:border-primary focus:bg-white transition resize-none",
                                required: true 
                            }),
                            e('div', { className: "flex justify-between mt-1" },
                                e('span', { className: "text-[10px] text-text-grey" }, "Be specific and honest."),
                                e('span', { className: "text-[10px] text-text-grey" }, `${form.details.length} chars`)
                            )
                        ),

                        e('button', { className: "w-full md:w-auto px-6 py-3 bg-primary text-white rounded-full font-bold text-sm hover:bg-primary-dark transition ripple shadow-md hover:shadow-lg" }, "Submit Report")
                    )
                ),

                // 3. REPORTS LIST
                e('div', { className: "bg-white rounded-xl border border-border-grey p-5 shadow-sm slide-up", style: { animationDelay: '0.2s' } },
                    e('div', { className: "flex flex-col md:flex-row justify-between items-start md:items-center gap-3 mb-4" },
                        e('h3', { className: "font-bold text-text-dark text-lg" }, "Community Reports"),
                        e('div', { className: "relative w-full md:w-64" },
                            e('input', { 
                                placeholder: "ðŸ” Search reports...", 
                                value: search, 
                                onChange: e => setSearch(e.target.value), 
                                className: "w-full p-2.5 bg-bg-grey border-none rounded-lg text-xs outline-none" 
                            })
                        )
                    ),
                    
                    loading ? e(React.Fragment, null, e(CardSkeleton), e(CardSkeleton)) :
                    e('div', { className: "space-y-3" }, 
                        filtered.length === 0 && e('div', {className: "text-center text-sm text-text-grey py-8 bg-bg-grey rounded-lg"}, 
                            "No reports found."
                        ),
                        filtered.map(r => 
                            e('div', { key: r.id, className: "report-card p-4 rounded-xl" },
                                e('div', { className: "flex justify-between items-start mb-2" },
                                    e('div', null,
                                        e('span', { className: "font-bold text-sm text-text-dark" }, r.hospital_name),
                                        e('span', { className: "ml-2 text-[9px] bg-primary/10 text-primary px-2 py-0.5 rounded-full font-semibold uppercase" }, r.category)
                                    ),
                                    e('span', { className: "text-[10px] text-text-grey whitespace-nowrap" }, new Date(r.created_at).toLocaleDateString())
                                ),
                                e('p', { className: "text-xs text-text-grey leading-relaxed" }, r.details),
                                
                                // Footer of card
                                e('div', { className: "mt-3 pt-2 border-t border-border-grey flex justify-between items-center" },
                                    e('span', { className: "text-[10px] text-text-grey flex items-center gap-1" }, 
                                        "ðŸ‘¤ ", 
                                        r.reporter_email ? r.reporter_email.substring(0, r.reporter_email.indexOf('@')) : 'Anonymous'
                                    ),
                                    e('span', { className: "text-[10px] text-success font-medium" }, "Verified Report")
                                )
                            )
                        )
                    )
                )
            );
        };

        // --- Other Pages (Feed, Jobs, Dashboard) kept consistent with previous version ---
        // NOTE: For brevity, I am condensing the unchanged logic but keeping the UI structure.
        
        const FeedPage = ({ user }) => {
            const [posts, setPosts] = React.useState([]); const [loading, setLoading] = React.useState(true);
            const [content, setContent] = React.useState(''); const [image, setImage] = React.useState(null);
            const isAdmin = user?.email === ADMIN_EMAIL; const toast = useToast();

            const fetchPosts = async () => { 
                setLoading(true);
                const data = await safeFetch(supabase.from('feed_posts').select('*').order('created_at', { ascending: false }).limit(20));
                const pinned = data.filter(p => p.is_pinned); const others = data.filter(p => !p.is_pinned);
                setPosts([...pinned, ...others]); setLoading(false); 
            };
            React.useEffect(() => { fetchPosts(); }, []);

            const handleSubmit = async (ev) => { 
                ev.preventDefault(); if(!content && !image) return; 
                await supabase.from('feed_posts').insert([{ content, image_url: image, poster_email: user.email }]); 
                setContent(''); setImage(null); fetchPosts(); toast("Post published!"); 
            };
            const handlePin = async (id, currentState) => {
                if (!currentState && posts.filter(p => p.is_pinned).length >= 3) { toast("Max 3 pinned posts", "error"); return; }
                await supabase.from('feed_posts').update({ is_pinned: !currentState }).eq('id', id);
                fetchPosts(); toast(currentState ? "Unpinned" : "Pinned");
            };
            const handleDelete = async (id) => { if(confirm("Delete?")) { await supabase.from('feed_posts').delete().eq('id', id); fetchPosts(); toast("Deleted", "error"); }};
            const handleImage = (e) => { const file = e.target.files[0]; if(file){ const r = new FileReader(); r.onloadend = () => setImage(r.result); r.readAsDataURL(file); }};

            return e('div', { className: "max-w-xl w-full mx-auto space-y-4 pb-20 md:pb-4" },
                isAdmin && e('div', { className: "bg-white rounded-lg border border-border-grey p-4 shadow-sm fade-in" },
                    e('form', { onSubmit: handleSubmit },
                        e('textarea', { placeholder: "Write an announcement...", value: content, onChange: (e) => setContent(e.target.value), className: "w-full p-3 bg-bg-grey rounded-lg outline-none text-sm resize-none border border-transparent hover:border-border-grey focus:border-primary focus:bg-white transition", rows: 3 }),
                        image && e('div', { className: "relative mt-2 inline-block" }, e('img', { src: image, className: "max-h-32 rounded-lg" }), e('button', { type: "button", onClick: () => setImage(null), className: "absolute top-1 right-1 bg-danger text-white rounded-full p-1 text-xs" }, "âœ•")),
                        e('div', { className: "flex justify-between items-center pt-3 border-t border-border-grey mt-3" },
                            e('label', { className: "cursor-pointer text-text-grey hover:text-primary transition" }, e('span', {className: "text-xl"}, "ðŸ–¼ï¸"), e('input', { type: "file", onChange: handleImage, className: "hidden" })),
                            e('button', { className: "px-4 py-1.5 bg-primary text-white rounded-full font-bold text-xs hover:bg-primary-dark transition" }, "Post")
                        )
                    )
                ),
                loading ? e(React.Fragment, null, e(CardSkeleton), e(CardSkeleton)) : 
                posts.map((post, i) => {
                    const isAdminPost = post.poster_email === ADMIN_EMAIL;
                    const displayName = isAdminPost ? "Bangladesh Radiology & Imaging Technologist Network" : post.poster_email.split('@')[0];
                    return e('div', { key: post.id, className: `bg-white rounded-lg border border-border-grey overflow-hidden shadow-sm fade-in hover:shadow-md transition-shadow ${post.is_pinned ? 'border-l-4 border-l-primary bg-blue-50/30' : ''}` },
                        e('div', { className: "p-4" },
                            e('div', { className: "flex justify-between items-start" },
                                e('div', { className: "flex gap-3" },
                                    e('div', { className: "w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden border" },
                                        isAdminPost ? e('img', { src: BRITN_LOGO_URL, className: "w-full h-full object-cover" }) : e('span', { className: "font-bold text-primary text-lg" }, displayName.charAt(0))
                                    ),
                                    e('div', null,
                                        e('h3', { className: "font-semibold text-sm text-text-dark leading-tight flex items-center gap-1" }, displayName, isAdminPost && e('span', { className: "verified-badge" }, "âœ“")),
                                        e('p', { className: "text-[10px] text-text-grey mt-0.5" }, new Date(post.created_at).toLocaleDateString())
                                    )
                                ),
                                isAdmin && e('div', {className: "flex gap-1"},
                                    e('button', { onClick: () => handlePin(post.id, post.is_pinned), className: `p-1.5 rounded-full transition ${post.is_pinned ? 'bg-primary text-white' : 'hover:bg-bg-grey text-text-grey'}` }, "ðŸ“Œ"),
                                    e('button', { onClick: () => handleDelete(post.id), className: "p-1.5 hover:bg-red-50 rounded-full text-text-grey hover:text-danger" }, "ðŸ—‘ï¸")
                                )
                            ),
                            post.is_pinned && e('div', { className: "mt-2 inline-flex items-center gap-1 text-[10px] font-bold text-primary uppercase" }, "ðŸ“Œ Pinned"),
                            e('p', { className: "text-sm text-text-dark mt-3 leading-relaxed whitespace-pre-wrap" }, post.content)
                        ),
                        post.image_url && e('img', { src: post.image_url, className: "w-full max-h-96 object-cover bg-slate-50 border-t" })
                    );
                })
            );
        };

        const JobsPage = ({ user }) => {
            const [jobs, setJobs] = React.useState([]); const [loading, setLoading] = React.useState(true);
            const [form, setForm] = React.useState({ title: '', location: '', salary: '', description: '' });
            const canPost = user?.email === ADMIN_EMAIL || user?.user_metadata?.role === 'hospital' || user?.user_metadata?.role === 'technologist';
            const toast = useToast();

            const fetch = async () => { setLoading(true); setJobs(await safeFetch(supabase.from('jobs').select('*').eq('is_approved', true).order('created_at', { ascending: false }).limit(20))); setLoading(false); };
            React.useEffect(() => { fetch(); }, []);

            const handleSubmit = async (ev) => {
                ev.preventDefault();
                await supabase.from('jobs').insert([{...form, poster_id: user.id, is_approved: canPost}]);
                setForm({}); toast("Job Posted"); fetch();
            };

            return e('div', { className: "max-w-3xl mx-auto pb-20 md:pb-4 fade-in" },
                canPost && e('div', { className: "bg-white rounded-lg border border-border-grey p-5 mb-4 shadow-sm" },
                    e('h2', { className: "font-bold text-lg text-text-dark mb-3" }, "âž• Post a New Job"),
                    e('form', { onSubmit: handleSubmit, className: "space-y-3" },
                        e('div', { className: "grid md:grid-cols-2 gap-3" },
                            e('input', { placeholder: "Job Title", value: form.title || '', onChange: e => setForm({...form, title: e.target.value}), className: "w-full p-3 border border-border-grey rounded-lg input-focus outline-none text-sm", required: true }),
                            e('input', { placeholder: "Location", value: form.location || '', onChange: e => setForm({...form, location: e.target.value}), className: "w-full p-3 border border-border-grey rounded-lg input-focus outline-none text-sm", required: true })
                        ),
                        e('input', { placeholder: "Salary (Optional)", value: form.salary || '', onChange: e => setForm({...form, salary: e.target.value}), className: "w-full p-3 border border-border-grey rounded-lg input-focus outline-none text-sm" }),
                        e('textarea', { placeholder: "Description...", value: form.description || '', onChange: e => setForm({...form, description: e.target.value}), className: "w-full p-3 border border-border-grey rounded-lg input-focus outline-none min-h-[150px] text-sm", required: true }),
                        e('button', { className: "w-full py-2.5 bg-primary text-white rounded-lg font-semibold text-sm hover:bg-primary-dark transition ripple" }, "Post Job")
                    )
                ),
                loading ? e(CardSkeleton) : e('div', { className: "space-y-3" },
                    jobs.map(job => 
                        e('div', { key: job.id, className: "bg-white rounded-lg border border-border-grey p-4 shadow-sm hover:shadow-md transition" },
                            e('div', { className: "flex justify-between items-start" },
                                e('div', null,
                                    e('h3', { className: "font-bold text-text-dark" }, job.title),
                                    e('p', { className: "text-xs text-text-grey mt-1" }, `ðŸ“ ${job.location}`),
                                    job.salary && e('p', { className: "text-xs text-success font-medium mt-0.5" }, `ðŸ’° ${job.salary}`)
                                )
                            ),
                            e('p', { className: "text-sm text-text-grey mt-3 line-clamp-2" }, job.description),
                            e('button', { className: "mt-3 w-full py-2 border border-primary text-primary rounded-full font-semibold text-xs hover:bg-primary hover:text-white transition" }, "Apply Now")
                        )
                    )
                )
            );
        };

        const Dashboard = ({ user, setPage, jobs }) => {
            return e('div', { className: "max-w-xl w-full mx-auto pb-20 md:pb-4 fade-in" },
                e('div', { className: "bg-white rounded-lg border border-border-grey p-4 mb-4 shadow-sm text-center" },
                    e('div', { className: "w-16 h-16 mx-auto bg-primary/10 rounded-full flex items-center justify-center text-3xl mb-2" }, "ðŸ‘‹"),
                    e('h2', { className: "font-bold text-text-dark" }, "Welcome, " + (user?.user_metadata?.full_name || "User")),
                    e('p', { className: "text-xs text-text-grey" }, "Stay connected with the community")
                ),
                e('div', { className: "grid grid-cols-2 gap-3" },
                    e('div', { onClick: () => setPage('feed'), className: "bg-white p-4 rounded-lg border border-border-grey cursor-pointer hover:shadow-md transition" },
                        e('div', { className: "text-2xl mb-1" }, "ðŸ“°"), e('h3', { className: "font-bold text-sm text-text-dark" }, "News Feed")
                    ),
                    e('div', { onClick: () => setPage('jobs'), className: "bg-white p-4 rounded-lg border border-border-grey cursor-pointer hover:shadow-md transition" },
                        e('div', { className: "text-2xl mb-1" }, "ðŸ’¼"), e('h3', { className: "font-bold text-sm text-text-dark" }, "Jobs")
                    ),
                    e('div', { onClick: () => setPage('reports'), className: "bg-white p-4 rounded-lg border border-border-grey cursor-pointer hover:shadow-md transition" },
                        e('div', { className: "text-2xl mb-1" }, "ðŸš©"), e('h3', { className: "font-bold text-sm text-text-dark" }, "Reports")
                    )
                )
            );
        };

        // --- Main Layout ---
        const ContentArea = ({ page, user, setPage, jobs }) => {
            const pages = { 'dash': e(Dashboard, { user, setPage, jobs }), 'feed': e(FeedPage, { user }), 'jobs': e(JobsPage, { user }), 'reports': e(ReportPage, { user }) };
            return pages[page] || pages['dash'];
        };

        const App = () => {
            const [user, setUser] = React.useState(null); const [view, setView] = React.useState('loading'); const [page, setPage] = React.useState('dash'); const [jobs, setJobs] = React.useState([]);
            React.useEffect(() => { supabase.auth.getSession().then(({ data: { session } }) => { setUser(session?.user); setView(session ? 'app' : 'login'); }); supabase.auth.onAuthStateChange((e, s) => { setUser(s?.user); setView(s?.user ? 'app' : 'login'); }); }, []);
            React.useEffect(() => { if(view === 'app') safeFetch(supabase.from('jobs').select('*').limit(3)).then(setJobs); }, [view]);

            if (view === 'loading') return e('div', { className: "flex h-screen items-center justify-center bg-bg-grey" }, e('div', { className: "loader" }));
            if (view === 'login') return e(AuthScreen, { type: 'login', onSwitch: setView, onSuccess: () => setView('app') });
            if (view === 'register') return e(AuthScreen, { type: 'register', onSwitch: setView });

            return e(ToastProvider, null,
                e('div', { className: "min-h-screen bg-bg-grey" },
                    e(TopNav, { user, onLogout: () => supabase.auth.signOut() }),
                    e('div', { className: "max-w-6xl mx-auto md:flex gap-6 p-4 pt-6" },
                        e(LeftSidebar, { user }),
                        e('main', { className: "flex-1 w-full min-w-0" }, e(ContentArea, { page, user, setPage, jobs })),
                        e(RightSidebar, { jobs })
                    ),
                    e(BottomNav, { page, setPage })
                )
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(e(App));
    </script>
</body>
</html>
