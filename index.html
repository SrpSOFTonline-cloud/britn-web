<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRITN - Professional Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 500: '#0066CC', 600: '#0052A3', 100: '#DBEAFE' },
                        accent: { 500: '#00B894' }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F1F5F9; margin: 0; }
        .sidebar { width: 250px; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #0066CC; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root" style="height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div class="loader"></div>
    </div>

    <script type="module">
        import React from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

        // --- Supabase Config ---
        const SUPABASE_URL = 'https://hosiwwylofzjtweclycv.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhvc2l3d3lsb2Z6anR3ZWNseWN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2NTc3ODgsImV4cCI6MjA4NzIzMzc4OH0.DkCioDXAQQYZm9NOhfsyuXvArR1TQjMMRf7OFv8FClA';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // Helper for creating elements
        const e = React.createElement;

        // --- Auth Components ---

        const LoginScreen = ({ onSwitch, onLogin }) => {
            const [email, setEmail] = React.useState('');
            const [pass, setPass] = React.useState('');
            const [error, setError] = React.useState('');
            const [loading, setLoading] = React.useState(false);

            const handleLogin = async (ev) => {
                ev.preventDefault();
                setLoading(true); setError('');
                const { error } = await supabase.auth.signInWithPassword({ email, password: pass });
                if (error) { setError(error.message); setLoading(false); }
                else { onLogin(); }
            };

            return e('div', { className: "min-h-screen flex items-center justify-center bg-slate-100 p-4" },
                e('div', { className: "bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border border-slate-200" },
                    e('div', { className: "text-center mb-6" },
                        e('div', { className: "w-16 h-16 bg-primary-500 rounded-2xl flex items-center justify-center text-white text-3xl font-bold mx-auto mb-3" }, "B"),
                        e('h2', { className: "text-2xl font-bold text-gray-800" }, "Welcome Back"),
                        e('p', { className: "text-gray-500 text-sm" }, "Login to BRITN")
                    ),
                    error && e('div', { className: "bg-red-50 text-red-600 p-3 rounded-lg mb-4 text-sm" }, error),
                    e('form', { onSubmit: handleLogin, className: "space-y-4" },
                        e('input', { type: "email", placeholder: "Email", value: email, onChange: (ev) => setEmail(ev.target.value), className: "w-full px-4 py-3 rounded-lg border border-slate-300 outline-none focus:ring-2 focus:ring-primary-500", required: true }),
                        e('input', { type: "password", placeholder: "Password", value: pass, onChange: (ev) => setPass(ev.target.value), className: "w-full px-4 py-3 rounded-lg border border-slate-300 outline-none focus:ring-2 focus:ring-primary-500", required: true }),
                        e('button', { type: "submit", disabled: loading, className: "w-full py-3 bg-primary-500 text-white rounded-lg font-semibold hover:bg-primary-600 disabled:opacity-50" }, loading ? "Logging..." : "Login"),
                        e('p', { className: "text-center text-sm mt-4" },
                            e('button', { type: "button", onClick: () => onSwitch('forgot'), className: "text-primary-500 hover:underline" }, "Forgot Password?")
                        )
                    ),
                    e('p', { className: "mt-6 text-center text-gray-600 text-sm" },
                        "Don't have an account? ",
                        e('button', { onClick: () => onSwitch('register'), className: "text-primary-500 font-semibold hover:underline" }, "Register")
                    )
                )
            );
        };

        const RegisterScreen = ({ onSwitch }) => {
            const [form, setForm] = React.useState({ fullName: '', email: '', password: '', role: 'student' });
            const [msg, setMsg] = React.useState({ type: '', text: '' });

            const handleChange = (ev) => setForm({ ...form, [ev.target.name]: ev.target.value });

            const handleRegister = async (ev) => {
                ev.preventDefault();
                const { error } = await supabase.auth.signUp({
                    email: form.email,
                    password: form.password,
                    options: { data: { full_name: form.fullName, role: form.role } }
                });
                if (error) setMsg({ type: 'error', text: error.message });
                else setMsg({ type: 'success', text: 'Success! Check email or try login.' });
            };

            return e('div', { className: "min-h-screen flex items-center justify-center bg-slate-100 p-4" },
                e('div', { className: "bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border border-slate-200" },
                    e('h2', { className: "text-2xl font-bold text-gray-800 mb-4" }, "Create Account"),
                    msg.text && e('div', { className: `p-3 rounded-lg mb-4 text-sm ${msg.type === 'error' ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-600'}` }, msg.text),
                    e('form', { onSubmit: handleRegister, className: "space-y-3" },
                        e('input', { name: "fullName", placeholder: "Full Name", onChange: handleChange, className: "w-full px-4 py-3 rounded-lg border outline-none", required: true }),
                        e('input', { name: "email", type: "email", placeholder: "Email", onChange: handleChange, className: "w-full px-4 py-3 rounded-lg border outline-none", required: true }),
                        e('input', { name: "password", type: "password", placeholder: "Password", onChange: handleChange, className: "w-full px-4 py-3 rounded-lg border outline-none", required: true }),
                        e('select', { name: "role", onChange: handleChange, className: "w-full px-4 py-3 rounded-lg border outline-none bg-white" },
                            e('option', { value: "student" }, "Student"),
                            e('option', { value: "technologist" }, "Technologist"),
                            e('option', { value: "hospital" }, "Hospital")
                        ),
                        e('button', { type: "submit", className: "w-full py-3 bg-accent-500 text-white rounded-lg font-semibold" }, "Register")
                    ),
                    e('p', { className: "mt-4 text-center text-sm" },
                        "Have an account? ",
                        e('button', { onClick: () => onSwitch('login'), className: "text-primary-500 font-semibold" }, "Login")
                    )
                )
            );
        };

        const ForgotScreen = ({ onSwitch }) => {
            const [email, setEmail] = React.useState('');
            const [msg, setMsg] = React.useState('');

            const handleReset = async (ev) => {
                ev.preventDefault();
                const { error } = await supabase.auth.resetPasswordForEmail(email);
                if (error) setMsg(error.message);
                else setMsg("Reset link sent! Check inbox.");
            };

            return e('div', { className: "min-h-screen flex items-center justify-center bg-slate-100 p-4" },
                e('div', { className: "bg-white p-8 rounded-2xl shadow-xl w-full max-w-md" },
                    e('h2', { className: "text-2xl font-bold mb-4" }, "Reset Password"),
                    msg && e('div', { className: "bg-blue-50 text-blue-600 p-3 rounded mb-4 text-sm" }, msg),
                    e('form', { onSubmit: handleReset, className: "space-y-4" },
                        e('input', { type: "email", placeholder: "Your Email", value: email, onChange: (ev) => setEmail(ev.target.value), className: "w-full px-4 py-3 rounded-lg border outline-none", required: true }),
                        e('button', { type: "submit", className: "w-full py-3 bg-primary-500 text-white rounded-lg" }, "Send Link"),
                        e('button', { type: "button", onClick: () => onSwitch('login'), className: "w-full py-3 text-gray-600" }, "Back to Login")
                    )
                )
            );
        };

        // --- Dashboard Components ---

        const Sidebar = ({ page, setPage, onLogout }) => {
            const menus = [
                { id: 'dash', name: 'Dashboard', icon: 'ðŸ ' },
                { id: 'hosp', name: 'Hospitals', icon: 'ðŸ¥' },
                { id: 'proc', name: 'Procedures', icon: 'ðŸ“–' },
                { id: 'jobs', name: 'Jobs', icon: 'ðŸ’¼' },
                { id: 'prof', name: 'Profile', icon: 'ðŸ‘¤' },
            ];

            return e('div', { className: "sidebar bg-white h-screen fixed left-0 top-0 border-r flex flex-col shadow-sm" },
                e('div', { className: "p-5 border-b" },
                    e('div', { className: "flex items-center space-x-2" },
                        e('div', { className: "w-10 h-10 bg-primary-500 rounded-xl flex items-center justify-center text-white font-bold" }, "B"),
                        e('span', { className: "font-bold text-xl text-gray-800" }, "BRITN")
                    )
                ),
                e('nav', { className: "flex-1 p-3 space-y-1" },
                    menus.map(m => 
                        e('button', { 
                            key: m.id, 
                            onClick: () => setPage(m.id), 
                            className: `w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition ${page === m.id ? 'bg-primary-100 text-primary-600 font-semibold' : 'text-gray-500 hover:bg-slate-50'}`
                        }, e('span', null, m.icon), e('span', null, m.name))
                    )
                ),
                e('div', { className: "p-3 border-t" },
                    e('button', { onClick: onLogout, className: "w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-red-500 hover:bg-red-50" }, 
                        e('span', null, 'ðŸšª'), e('span', null, "Logout")
                    )
                )
            );
        };

        const ContentArea = ({ page, user }) => {
            if (page === 'hosp') return e('div', null, e('h2', {className: "text-2xl font-bold mb-4"}, "Hospital Directory"), e('p', {className: "text-gray-500"}, "Loading hospital list from database..."));
            if (page === 'proc') return e('div', null, e('h2', {className: "text-2xl font-bold mb-4"}, "Procedures"), e('p', {className: "text-gray-500"}, "Radiographic positioning library..."));
            if (page === 'jobs') return e('div', null, e('h2', {className: "text-2xl font-bold mb-4"}, "Jobs"), e('p', {className: "text-gray-500"}, "Available radiology jobs..."));
            if (page === 'prof') return e('div', { className: "bg-white p-6 rounded-xl shadow-sm border" }, 
                e('h2', {className: "text-xl font-bold mb-4"}, "My Profile"),
                e('p', {}, `Name: ${user?.user_metadata?.full_name || 'N/A'}`),
                e('p', {}, `Email: ${user?.email}`),
                e('p', {}, `Role: ${user?.user_metadata?.role || 'N/A'}`)
            );
            
            // Dashboard Default
            return e('div', null,
                e('h1', { className: "text-2xl font-bold text-gray-800 mb-6" }, `Welcome, ${user?.user_metadata?.full_name || 'User'}!`),
                e('div', { className: "grid grid-cols-1 md:grid-cols-4 gap-4 mb-8" },
                    e('div', { className: "bg-white p-4 rounded-xl shadow-sm border" }, e('p', {className: "text-gray-500 text-sm"}, "Hospitals"), e('p', {className: "text-2xl font-bold"}, "500+")),
                    e('div', { className: "bg-white p-4 rounded-xl shadow-sm border" }, e('p', {className: "text-gray-500 text-sm"}, "Procedures"), e('p', {className: "text-2xl font-bold"}, "150+")),
                    e('div', { className: "bg-white p-4 rounded-xl shadow-sm border" }, e('p', {className: "text-gray-500 text-sm"}, "Jobs"), e('p', {className: "text-2xl font-bold"}, "25")),
                    e('div', { className: "bg-white p-4 rounded-xl shadow-sm border" }, e('p', {className: "text-gray-500 text-sm"}, "Members"), e('p', {className: "text-2xl font-bold"}, "2000+"))
                )
            );
        };

        // --- Main App ---
        const App = () => {
            const [user, setUser] = React.useState(null);
            const [view, setView] = React.useState('loading'); // loading, login, register, forgot, app
            const [page, setPage] = React.useState('dash');

            React.useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    if (session) { setUser(session.user); setView('app'); } 
                    else { setView('login'); }
                });
                const { data: { subscription } } = supabase.auth.onAuthStateChange((e, s) => {
                    if (s) { setUser(s.user); setView('app'); }
                    else { setUser(null); setView('login'); }
                });
                return () => subscription.unsubscribe();
            }, []);

            const handleLogout = async () => { await supabase.auth.signOut(); };

            if (view === 'loading') return e('div', { className: "h-screen flex items-center justify-center" }, e('div', { className: "loader" }));
            if (view === 'login') return e(LoginScreen, { onSwitch: setView, onLogin: () => setView('app') });
            if (view === 'register') return e(RegisterScreen, { onSwitch: setView });
            if (view === 'forgot') return e(ForgotScreen, { onSwitch: setView });

            return e('div', { className: "flex bg-slate-100 min-h-screen" },
                e(Sidebar, { page, setPage, onLogout: handleLogout }),
                e('div', { className: "ml-64 flex-1 p-8" },
                    e(ContentArea, { page, user })
                )
            );
        };

        // Render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(e(App));
    </script>
</body>
</html>
