<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BRITN - Professional Network</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0A1931',
                        accent: '#1F4068',
                        highlight: '#FFD700',
                        success: '#00C897',
                        danger: '#FF4C4C',
                        surface: 'rgba(255, 255, 255, 0.05)',
                        'surface-light': 'rgba(255, 255, 255, 0.1)',
                    }
                }
            }
        }
    </script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #0A1931 0%, #1F4068 100%);
            margin: 0; 
            color: #FFFFFF;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .font-bangla { font-family: 'Hind Siliguri', sans-serif; }
        
        /* Glassmorphism Utilities */
        .glass {
            background: rgba(255, 255, 255, 0.07);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #0A1931;
        }
        .glass-dark {
            background: rgba(10, 25, 49, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Inputs */
        .input-smart {
            width: 100%; 
            padding: 12px 16px; 
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2); 
            border-radius: 12px; 
            outline: none; 
            font-size: 14px;
            color: #0A1931;
            transition: all 0.3s ease;
        }
        .input-smart:focus { 
            border-color: #00C897; 
            background: #FFFFFF; 
            box-shadow: 0 0 0 3px rgba(0, 200, 151, 0.2); 
        }
        .input-dark {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
        }
        .input-dark::placeholder { color: rgba(255,255,255,0.6); }
        .input-dark:focus { 
            background: rgba(255, 255, 255, 0.15); 
            border-color: #00C897; 
            box-shadow: 0 0 0 2px rgba(0, 200, 151, 0.2);
        }

        /* Loader */
        .loader { 
            border: 3px solid rgba(255, 255, 255, 0.1); 
            border-top: 3px solid #00C897; 
            border-radius: 50%; 
            width: 30px; 
            height: 30px; 
            animation: spin 0.8s linear infinite; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Verified Badge */
        .verified-badge { 
            background: linear-gradient(135deg, #FFD700, #FFA500); 
            color: #0A1931; 
            padding: 2px 8px; 
            border-radius: 6px; 
            font-size: 9px; 
            font-weight: 800; 
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Sidebar */
        .sidebar-design { 
            background: rgba(10, 25, 49, 0.8); 
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.05); 
        }
        .nav-item { 
            transition: all 0.2s; 
            border-left: 3px solid transparent; 
            color: rgba(255, 255, 255, 0.7);
        }
        .nav-item.active { 
            background: rgba(255, 255, 255, 0.1); 
            border-left-color: #00C897; 
            color: #FFFFFF; 
            font-weight: 600; 
        }
        .nav-item:hover { background: rgba(255, 255, 255, 0.05); color: white; }

        /* Bottom Nav */
        .bottom-nav-item {
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.5);
            transition: all 0.2s;
            font-size: 10px;
            gap: 2px;
        }
        .bottom-nav-item.active { color: #00C897; }
        .bottom-nav-item span.icon { font-size: 20px; transition: transform 0.2s; }
        .bottom-nav-item.active span.icon { transform: translateY(-2px); }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.4); }
        
        button { touch-action: manipulation; position: relative; overflow: hidden; }
        
        /* Ripple Effect Stub */
        .ripple:after {
            content: "";
            display: block;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
            background-repeat: no-repeat;
            background-position: 50%;
            transform: scale(10, 10);
            opacity: 0;
            transition: transform .4s, opacity .8s;
        }
        .ripple:active:after {
            transform: scale(0, 0);
            opacity: .2;
            transition: 0s;
        }

        /* Toast */
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; }
        .toast { padding: 12px 20px; border-radius: 12px; color: white; font-size: 13px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); animation: slideIn 0.3s ease-out; }
        .toast-success { background: #00C897; }
        .toast-error { background: #FF4C4C; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>
    <div id="root" style="height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div class="loader"></div>
    </div>

    <script type="module">
        import React from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

        // --- CONFIGURATION ---
        const BRITN_LOGO_URL = 'https://z-cdn-media.chatglm.cn/files/947017d9-2ded-4447-ab50-1dfd8ce35fcd.jpg?auth_key=1871748799-320010bf4fcc40a98d5d6172607e7c73-0-134513578fae2800da62ba56df7d4c44';
        const DONATION_NUMBER = '01843860547';
        const SUPABASE_URL = 'https://hosiwwylofzjtweclycv.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhvc2l3d3lsb2Z6anR3ZWNseWN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2NTc3ODgsImV4cCI6MjA4NzIzMzc4OH0.DkCioDXAQQYZm9NOhfsyuXvArR1TQjMMRf7OFv8FClA';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
        
        const ADMIN_EMAIL = 'admin@britn.com';
        const e = React.createElement;

        // --- Context for Toasts ---
        const ToastContext = React.createContext(null);
        const ToastProvider = ({ children }) => {
            const [toasts, setToasts] = React.useState([]);
            const addToast = (message, type = 'success') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type }]);
                setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 3000);
            };
            return e(ToastContext.Provider, { value: addToast }, 
                children,
                e('div', { className: "toast-container" }, 
                    toasts.map(t => e('div', { key: t.id, className: `toast toast-${t.type}` }, t.message))
                )
            );
        };
        const useToast = () => React.useContext(ToastContext);

        // --- Helper ---
        const safeFetch = async (query) => {
            try { const { data, error } = await query; if (error) throw error; return data || []; } 
            catch (err) { console.error("Fetch Error:", err); return []; }
        };

        // --- Smart Auth Screen ---
        const AuthScreen = ({ type, onSwitch, onSuccess }) => {
            const [form, setForm] = React.useState({ email: '', pass: '', name: '', role: 'student' });
            const [error, setError] = React.useState('');
            const [loading, setLoading] = React.useState(false);
            
            const handleAuth = async (ev) => {
                ev.preventDefault(); setError(''); setLoading(true);
                try {
                    if (type === 'login') {
                        const { error } = await supabase.auth.signInWithPassword({ email: form.email, password: form.pass });
                        if (error) throw error; onSuccess();
                    } else {
                        if (form.email === ADMIN_EMAIL) throw new Error("Admin email reserved.");
                        const { error } = await supabase.auth.signUp({
                            email: form.email, password: form.pass,
                            options: { data: { full_name: form.name, role: form.role } }
                        });
                        if (error) throw error;
                        alert("Registered! Please login."); onSwitch('login');
                    }
                } catch (err) { setError(err.message); } finally { setLoading(false); }
            };

            return e('div', { className: "min-h-screen flex flex-col md:flex-row items-center justify-center p-4 relative overflow-hidden" },
                // Background Decoration
                e('div', { className: "absolute top-0 left-0 w-96 h-96 bg-accent rounded-full filter blur-3xl opacity-20 -translate-x-1/2 -translate-y-1/2" }),
                e('div', { className: "absolute bottom-0 right-0 w-96 h-96 bg-primary rounded-full filter blur-3xl opacity-20 translate-x-1/2 translate-y-1/2" }),
                
                // Card
                e('div', { className: "relative z-10 w-full max-w-sm fade-in" },
                    e('div', { className: "glass-card rounded-3xl p-8 shadow-2xl" },
                        // Logo Header
                        e('div', { className: "text-center mb-6" },
                            e('div', { className: "w-16 h-16 mx-auto bg-primary rounded-2xl flex items-center justify-center shadow-lg mb-3 transform hover:rotate-6 transition-transform" },
                                e('img', { src: BRITN_LOGO_URL, className: "w-10 h-10 object-contain" })
                            ),
                            e('h1', { className: "text-2xl font-bold text-primary" }, "BRITN"),
                            e('p', { className: "text-slate-500 text-xs font-bangla mt-1" }, "Bangladesh Radiology & Imaging Technologist Network")
                        ),
                        
                        error && e('div', { className: "bg-red-50 text-red-600 p-3 rounded-xl mb-4 text-xs text-center font-medium" }, error),
                        
                        e('form', { onSubmit: handleAuth, className: "space-y-4" },
                            type === 'register' && 
                                e('input', { placeholder: "Full Name", onChange: (ev) => setForm({...form, name: ev.target.value}), className: "input-smart", required: true }),
                            e('input', { type: "email", placeholder: "Email", value: form.email, onChange: (ev) => setForm({...form, email: ev.target.value}), className: "input-smart", required: true }),
                            e('input', { type: "password", placeholder: "Password", value: form.pass, onChange: (ev) => setForm({...form, pass: ev.target.value}), className: "input-smart", required: true }),
                            
                            type === 'register' && e('div', { className: "grid grid-cols-3 gap-2 pt-1" }, 
                                ['student', 'technologist', 'hospital'].map(r => 
                                    e('button', { type: "button", key: r, onClick: () => setForm({...form, role: r}), 
                                        className: `py-2 rounded-xl text-xs font-semibold transition-all duration-200 border ${form.role === r ? 'bg-primary text-white border-primary shadow-md' : 'bg-slate-50 border-slate-200 text-slate-500 hover:bg-slate-100'}` 
                                    }, r.charAt(0).toUpperCase() + r.slice(1))
                                )
                            ),
                            e('button', { type: "submit", disabled: loading, className: "w-full py-3 bg-primary text-white rounded-xl font-bold text-sm hover:bg-accent transition-all duration-300 shadow-lg hover:shadow-xl mt-2 ripple" }, 
                                loading ? e('div', {className: "loader mx-auto border-white border-t-transparent"}, null) : "Continue"
                            )
                        ),
                        
                        e('div', { className: "mt-6 text-center text-xs text-slate-400" },
                            type === 'login' ? "No account yet? " : "Already registered? ",
                            e('button', { onClick: () => onSwitch(type === 'login' ? 'register' : 'login'), className: "text-accent font-bold hover:underline" }, type === 'login' ? "Sign Up" : "Sign In")
                        )
                    ),
                    e('p', { className: "text-center text-[10px] text-slate-300 mt-4 opacity-60" }, "Powered by SRP SOFT LTD")
                )
            );
        };

        // --- Sidebar (Desktop) ---
        const Sidebar = ({ page, setPage, onLogout, role, isOpen, setIsOpen, userEmail }) => {
            const isAdmin = userEmail === ADMIN_EMAIL || role === 'super_admin';
            const canPost = role === 'hospital' || role === 'technologist' || isAdmin;
            
            const menus = [
                { id: 'dash', name: 'Dashboard', icon: 'ðŸ ' },
                { id: 'feed', name: 'News Feed', icon: 'ðŸ“°' },
                { id: 'jobs', name: 'Jobs', icon: 'ðŸ’¼' },
                { id: 'reports', name: 'Reports', icon: 'ðŸš©' },
                { id: 'profile', name: 'Profile', icon: 'ðŸ‘¤' },
            ];
            const posterMenus = [ { id: 'add_job', name: 'Post Job', icon: 'âž•' }, { id: 'my_jobs', name: 'My Posts', icon: 'ðŸ“' } ];
            const adminMenus = [ { id: 'approvals', name: 'Approvals', icon: 'âœ…' }, { id: 'manage_all', name: 'Manage All', icon: 'âš™ï¸' } ];

            const sidebarClass = `fixed inset-y-0 left-0 z-40 w-64 sidebar-design text-white transform transition-transform duration-300 ease-in-out 
                ${isOpen ? 'translate-x-0' : '-translate-x-full'} 
                md:translate-x-0 md:static md:w-72`;

            return e('div', { className: sidebarClass },
                e('div', { className: "p-4 flex items-center justify-between border-b border-white/10" },
                    e('div', { className: "flex items-center gap-3" },
                        e('img', { src: BRITN_LOGO_URL, className: "w-10 h-10 rounded-xl shadow-md" }),
                        e('div', null,
                            e('span', { className: "font-bold text-lg tracking-wide" }, "BRITN"),
                            e('span', { className: "block text-[9px] text-white/50 font-bangla" }, "Professional Network")
                        )
                    ),
                    e('button', { onClick: () => setIsOpen(false), className: "md:hidden p-2 rounded-lg hover:bg-white/10" }, "âœ•")
                ),
                
                e('nav', { className: "flex-1 py-4 space-y-1 overflow-y-auto px-3" },
                    menus.map(m => 
                        e('button', { key: m.id, onClick: () => { setPage(m.id); setIsOpen(false); }, className: `nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg ${page === m.id ? 'active' : ''}` },
                            e('span', {className: "text-lg"}, m.icon), e('span', {className: "font-medium text-sm"}, m.name)
                        )
                    ),
                    canPost && e('div', {className: "pt-4 mt-4 border-t border-white/10"}, 
                        e('p', {className: "px-4 text-[10px] text-white/30 uppercase mb-2"}, "Content"),
                        posterMenus.map(m => 
                            e('button', { key: m.id, onClick: () => { setPage(m.id); setIsOpen(false); }, className: `nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg ${page === m.id ? 'active' : ''}` },
                                e('span', {className: "text-lg"}, m.icon), e('span', {className: "font-medium text-sm"}, m.name)
                            )
                        )
                    ),
                    isAdmin && e('div', {className: "pt-4 mt-4 border-t border-white/10"}, 
                        e('p', {className: "px-4 text-[10px] text-white/30 uppercase mb-2"}, "Admin Panel"),
                        adminMenus.map(m => 
                            e('button', { key: m.id, onClick: () => { setPage(m.id); setIsOpen(false); }, className: `nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-300 hover:bg-red-500/10 ${page === m.id ? 'bg-red-500/20 text-red-200' : ''}` },
                                e('span', {className: "text-lg"}, m.icon), e('span', {className: "font-medium text-sm"}, m.name)
                            )
                        )
                    )
                ),
                e('div', { className: "p-4 border-t border-white/10" },
                    e('button', { onClick: onLogout, className: "w-full flex items-center justify-center gap-2 px-4 py-2 bg-danger/10 text-danger hover:bg-danger hover:text-white rounded-xl text-sm font-semibold transition-all" }, 
                        e('span', null, "ðŸšª"), "Logout"
                    )
                )
            );
        };

        // --- Bottom Nav (Mobile) ---
        const BottomNav = ({ page, setPage }) => {
            const items = [ { id: 'dash', icon: 'ðŸ ', label: 'Home' }, { id: 'feed', icon: 'ðŸ“°', label: 'Feed' }, { id: 'jobs', icon: 'ðŸ’¼', label: 'Jobs' }, { id: 'profile', icon: 'ðŸ‘¤', label: 'Profile' } ];
            return e('div', { className: "md:hidden fixed bottom-0 left-0 right-0 glass-dark z-50 border-t border-white/10" },
                e('div', { className: "flex justify-around items-center h-16" },
                    items.map(item => 
                        e('button', { key: item.id, onClick: () => setPage(item.id), className: `bottom-nav-item flex-1 h-full pt-1 ${page === item.id ? 'active' : ''}` },
                            e('span', { className: "icon" }, item.icon),
                            e('span', { className: "font-medium" }, item.label)
                        )
                    )
                )
            );
        };

        // --- Feed Page ---
        const FeedPage = ({ user }) => {
            const [posts, setPosts] = React.useState([]); const [loading, setLoading] = React.useState(true);
            const [content, setContent] = React.useState(''); const [image, setImage] = React.useState(null);
            const [editId, setEditId] = React.useState(null); const [editContent, setEditContent] = React.useState('');
            const isAdmin = user?.email === ADMIN_EMAIL;
            const toast = useToast();

            const fetchPosts = async () => { setPosts(await safeFetch(supabase.from('feed_posts').select('*').order('created_at', { ascending: false }).limit(20))); setLoading(false); };
            React.useEffect(() => { fetchPosts(); }, []);

            const handleSubmit = async (ev) => { ev.preventDefault(); if(!content && !image) return; await supabase.from('feed_posts').insert([{ content, image_url: image, poster_email: user.email }]); setContent(''); setImage(null); fetchPosts(); toast("Post published!"); };
            const handleDelete = async (id) => { if(confirm("Delete?")) { await supabase.from('feed_posts').delete().eq('id', id); fetchPosts(); toast("Post deleted", "error"); } };
            const handleEdit = (post) => { setEditId(post.id); setEditContent(post.content); };
            const handleUpdate = async (id) => { await supabase.from('feed_posts').update({ content: editContent }).eq('id', id); setEditId(null); fetchPosts(); toast("Post updated!"); };
            const handleImage = (e) => { const file = e.target.files[0]; if(file){ const r = new FileReader(); r.onloadend = () => setImage(r.result); r.readAsDataURL(file); }};

            if (loading) return e('div', {className: "flex justify-center py-10"}, e('div', {className: "loader"}));

            return e('div', { className: "max-w-xl mx-auto space-y-4 pb-20 md:pb-4" },
                isAdmin && e('div', { className: "glass rounded-2xl p-4 mb-2 fade-in" },
                    e('form', { onSubmit: handleSubmit },
                        e('textarea', { placeholder: "Write an announcement...", value: content, onChange: (e) => setContent(e.target.value), className: "w-full p-3 bg-transparent outline-none text-white text-sm resize-none placeholder-white/40", rows: 3 }),
                        image && e('div', { className: "relative mt-2 inline-block" }, e('img', { src: image, className: "max-h-32 rounded-lg" }), e('button', { type: "button", onClick: () => setImage(null), className: "absolute top-1 right-1 bg-danger text-white rounded-full p-1 text-xs" }, "âœ•")),
                        e('div', { className: "flex justify-between items-center pt-3 border-t border-white/10 mt-2" },
                            e('label', { className: "text-white/50 cursor-pointer hover:text-white transition-colors" }, 
                                e('span', {className: "text-xl"}, "ðŸ–¼ï¸"), 
                                e('input', { type: "file", onChange: handleImage, className: "hidden" })
                            ),
                            e('button', { className: "px-5 py-2 bg-success text-primary font-bold rounded-xl text-sm hover:opacity-90 transition ripple" }, "Post")
                        )
                    )
                ),

                posts.map((post, i) => {
                    const isAdminPost = post.poster_email === ADMIN_EMAIL;
                    const displayName = isAdminPost ? "Bangladesh Radiology & Imaging Technologist Network" : post.poster_email.split('@')[0];
                    const avatar = isAdminPost ? e('img', { src: BRITN_LOGO_URL, className: "w-10 h-10 rounded-full object-cover ring-2 ring-highlight" }) : 
                                               e('div', { className: "w-10 h-10 bg-accent rounded-full flex items-center justify-center font-bold text-white text-xs" }, displayName.charAt(0).toUpperCase());

                    return e('div', { key: post.id, className: "glass-card rounded-2xl overflow-hidden fade-in", style: { animationDelay: `${i * 0.05}s` } },
                        e('div', { className: "p-4" },
                            e('div', { className: "flex justify-between items-start" },
                                e('div', { className: "flex gap-3" },
                                    avatar,
                                    e('div', null,
                                        e('h3', { className: "font-bold text-sm text-primary leading-tight flex items-center gap-2" }, 
                                            displayName, 
                                            isAdminPost && e('span', { className: "verified-badge" }, "âœ“ VERIFIED")
                                        ),
                                        e('p', { className: "text-[10px] text-slate-400 mt-0.5" }, new Date(post.created_at).toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }))
                                    )
                                ),
                                isAdmin && e('div', {className: "flex gap-1"},
                                    e('button', { onClick: () => handleEdit(post), className: "p-1.5 hover:bg-slate-100 rounded-lg text-slate-400 text-xs" }, "âœï¸"),
                                    e('button', { onClick: () => handleDelete(post.id), className: "p-1.5 hover:bg-red-50 rounded-lg text-red-400 text-xs" }, "ðŸ—‘ï¸")
                                )
                            ),
                            
                            editId === post.id ? 
                                e('div', {className: "mt-3"},
                                    e('textarea', { value: editContent, onChange: (e) => setEditContent(e.target.value), className: "w-full bg-slate-50 p-2 border rounded-xl text-sm outline-none focus:ring-1" }),
                                    e('div', {className: "flex gap-2 mt-2 justify-end"},
                                        e('button', { onClick: () => handleUpdate(post.id), className: "px-3 py-1 bg-success text-white text-xs rounded-lg" }, "Save"),
                                        e('button', { onClick: () => setEditId(null), className: "px-3 py-1 bg-slate-100 text-xs rounded-lg" }, "Cancel")
                                    )
                                )
                                :
                                e('p', { className: "text-slate-600 text-sm mt-3 leading-relaxed" }, post.content)
                        ),
                        post.image_url && e('img', { src: post.image_url, className: "w-full bg-slate-50 border-t" })
                    );
                })
            );
        };

        // --- Profile Page ---
        const ProfilePage = ({ user }) => {
            return e('div', { className: "max-w-xl mx-auto pb-20 md:pb-4 fade-in" },
                e('div', { className: "glass rounded-2xl p-6 text-center" },
                    e('div', { className: "w-20 h-20 mx-auto bg-accent rounded-full flex items-center justify-center text-3xl mb-4 ring-4 ring-highlight" }, 
                        user?.email?.charAt(0).toUpperCase() 
                    ),
                    e('h2', { className: "text-xl font-bold text-white" }, user?.user_metadata?.full_name || "User"),
                    e('p', { className: "text-white/60 text-sm mt-1" }, user?.email),
                    e('div', { className: "mt-4 inline-block px-3 py-1 rounded-full bg-success/20 text-success text-xs font-bold uppercase" }, 
                        user?.user_metadata?.role || "Member"
                    ),
                    e('div', { className: "mt-6 border-t border-white/10 pt-4 grid grid-cols-2 gap-4 text-center" },
                        e('div', null, e('p', {className: "text-white/40 text-[10px]"}, "STATUS"), e('p', {className: "text-white font-bold"}, "Active")),
                        e('div', null, e('p', {className: "text-white/40 text-[10px]"}, "JOINED"), e('p', {className: "text-white font-bold"}, new Date(user?.created_at).getFullYear()))
                    )
                )
            );
        };

        // --- About Page ---
        const AboutPage = () => {
            const handleCopy = () => { navigator.clipboard.writeText(DONATION_NUMBER); alert('Number Copied!'); };
            return e('div', { className: "max-w-xl mx-auto space-y-4 pb-20 md:pb-4 fade-in" },
                e('div', { className: "glass rounded-2xl p-6 text-center" },
                    e('img', { src: BRITN_LOGO_URL, className: "w-20 h-20 mx-auto mb-2 rounded-xl shadow-lg" }),
                    e('h1', { className: "font-bold text-lg font-bangla text-white" }, "Bangladesh Radiology & Imaging Technologist Network"),
                    e('p', { className: "text-white/50 text-xs mt-2" }, "Connecting professionals across the nation.")
                ),
                e('div', { className: "glass rounded-2xl p-4" },
                    e('h2', { className: "font-bold text-sm mb-2 text-highlight" }, "â¤ï¸ Support the Cause"),
                    e('p', { className: "text-white/60 text-xs mb-3 font-bangla" }, "à¦¸à¦¾à¦°à§à¦­à¦¾à¦° à¦–à¦°à¦š à¦¬à¦¹à¦¨à§‡ à¦¸à¦¹à¦¯à§‹à¦—à¦¿à¦¤à¦¾ à¦•à¦°à§à¦¨à¥¤"),
                    e('div', { className: "grid grid-cols-2 gap-3" },
                        e('div', { className: "bg-pink-600 p-3 rounded-xl text-center shadow-md transform hover:scale-105 transition-transform" }, e('h3', {className: "font-bold text-sm"}, "bKash"), e('p', {className: "font-mono text-[11px] my-1"}, DONATION_NUMBER), e('button', { onClick: handleCopy, className: "bg-white/20 text-white px-2 py-0.5 rounded text-[10px]" }, "Copy")),
                        e('div', { className: "bg-orange-500 p-3 rounded-xl text-center shadow-md transform hover:scale-105 transition-transform" }, e('h3', {className: "font-bold text-sm"}, "Nagad"), e('p', {className: "font-mono text-[11px] my-1"}, DONATION_NUMBER), e('button', { onClick: handleCopy, className: "bg-white/20 text-white px-2 py-0.5 rounded text-[10px]" }, "Copy"))
                    )
                ),
                e('p', { className: "text-center text-[10px] text-white/30" }, "Developed by ", e('span', {className: "font-bold text-white/50"}, "SRP SOFT LTD"))
            );
        };

        // --- Report List ---
        const ReportList = ({ user }) => {
            const [reports, setReports] = React.useState([]); const [form, setForm] = React.useState({ hospital_name: '', category: 'Bad Behavior', details: '' }); const [search, setSearch] = React.useState('');
            const isAdmin = user?.email === ADMIN_EMAIL;
            const toast = useToast();
            const fetch = async () => setReports(await safeFetch(supabase.from('hospital_reports').select('*').order('created_at', { ascending: false }).limit(50)));
            React.useEffect(() => { fetch(); }, []);
            const handleSubmit = async (ev) => { ev.preventDefault(); await supabase.from('hospital_reports').insert([{...form, reporter_email: user?.email}]); setForm({ hospital_name: '', details: '' }); fetch(); toast("Report Submitted"); };
            const handleDelete = async (id) => { await supabase.from('hospital_reports').delete().eq('id', id); fetch(); };
            const filtered = reports.filter(r => r.hospital_name.toLowerCase().includes(search.toLowerCase()));
            return e('div', {className: "max-w-xl mx-auto pb-20 md:pb-4 fade-in"}, 
                e('div', { className: "flex justify-between items-center mb-3" }, e('h2', {className: "font-bold text-white text-lg"}, "ðŸš© Reports"), e('input', {placeholder: "Search...", value: search, onChange: e => setSearch(e.target.value), className: "input-dark py-1 w-28 text-xs rounded-lg"})),
                e('div', { className: "glass rounded-2xl p-4 mb-3" },
                    e('form', { onSubmit: handleSubmit, className: "space-y-2" },
                        e('input', { placeholder: "Hospital Name", value: form.hospital_name, onChange: e => setForm({...form, hospital_name: e.target.value}), className: "input-dark py-2 text-xs rounded-lg", required: true }),
                        e('textarea', { placeholder: "Details...", value: form.details, onChange: e => setForm({...form, details: e.target.value}), className: "input-dark py-2 text-xs rounded-lg", rows: 2 }),
                        e('button', { className: "w-full py-2 bg-danger text-white rounded-lg text-xs font-bold ripple" }, "Submit Report")
                    )
                ),
                e('div', { className: "space-y-2" }, filtered.map(r => 
                    e('div', { key: r.id, className: "glass rounded-xl p-3 flex justify-between items-start" },
                        e('div', null, 
                            e('span', {className: "font-bold text-sm text-white"}, r.hospital_name), 
                            e('br'), 
                            e('span', {className: "text-[10px] text-white/60"}, r.details)
                        ),
                        isAdmin && e('button', { onClick: () => handleDelete(r.id), className: "text-white/30 hover:text-danger text-xs p-1" }, "âœ•")
                    )
                ))
            );
        };

        // --- Job List & Forms ---
        const JobList = ({ title, filter, isAdmin, user }) => {
            const [jobs, setJobs] = React.useState([]); const [loading, setLoading] = React.useState(true); const [search, setSearch] = React.useState('');
            const fetch = async () => { setLoading(true); let q = supabase.from('jobs').select('*'); if (filter === 'pending') q = q.eq('is_approved', false); else if (filter === 'approved') q = q.eq('is_approved', true); else if (filter === 'my_posts') q = q.eq('poster_id', user.id); setJobs(await safeFetch(q.order('created_at', { ascending: false }).limit(20))); setLoading(false); };
            React.useEffect(() => { fetch(); }, [filter]);
            const action = async (id, a) => { if(a==='del') await supabase.from('jobs').delete().eq('id', id); if(a==='app') await supabase.from('jobs').update({ is_approved: true }).eq('id', id); fetch(); };
            if(loading) return e('div', {className: "flex justify-center py-10"}, e('div', {className: "loader"}));
            return e('div', {className: "max-w-xl mx-auto pb-20 md:pb-4 fade-in"},
                e('div', { className: "flex justify-between items-center mb-3" }, e('h2', {className: "font-bold text-white text-lg"}, title), e('input', {placeholder: "Search...", value: search, onChange: e => setSearch(e.target.value), className: "input-dark py-1 w-28 text-xs rounded-lg"})),
                e('div', {className: "space-y-2"}, jobs.filter(j => j.title.toLowerCase().includes(search.toLowerCase())).map(j => 
                    e('div', {key: j.id, className: "glass rounded-2xl p-4"}, 
                        e('div', {className: "flex justify-between items-start"}, 
                            e('div', null,
                                e('h3', {className: "font-bold text-white"}, j.title),
                                e('p', {className: "text-xs text-white/50 mt-1"}, `ðŸ“ ${j.location} | ðŸ’° ${j.salary || 'N/A'}`)
                            ),
                            !j.is_approved && e('span', {className: "text-[9px] bg-highlight text-primary px-2 py-0.5 rounded-full font-bold"}, "PENDING")
                        ),
                        e('p', {className: "text-slate-200 text-xs mt-2"}, j.description),
                        e('div', {className: "flex gap-2 mt-3 justify-end"}, 
                            isAdmin && !j.is_approved && e('button', {onClick: () => action(j.id, 'app'), className: "text-[10px] px-3 py-1 bg-success text-white rounded-lg font-bold ripple"}, "Approve"),
                            (isAdmin || j.poster_id === user.id) && e('button', {onClick: () => action(j.id, 'del'), className: "text-[10px] px-3 py-1 bg-danger/20 text-danger rounded-lg font-bold"}, "Delete")
                        )
                    )
                ))
            );
        };

        const AddJobForm = ({ user, isAdmin }) => {
            const [form, setForm] = React.useState({ title: '', location: '', salary: '', description: '' }); const toast = useToast();
            const submit = async (ev) => { ev.preventDefault(); await supabase.from('jobs').insert([{...form, poster_id: user.id, is_approved: isAdmin}]); toast("Job Posted!"); setForm({}); };
            return e('div', { className: "max-w-xl mx-auto fade-in pb-20 md:pb-4" },
                e('div', { className: "glass rounded-2xl p-6" },
                    e('h2', { className: "font-bold text-lg mb-4 text-white font-bangla" }, "à¦¨à¦¤à§à¦¨ à¦šà¦¾à¦•à¦°à¦¿ à¦ªà§‹à¦¸à§à¦Ÿ à¦•à¦°à§à¦¨"),
                    e('form', { onSubmit: submit, className: "space-y-3" },
                        e('input', { placeholder: "Job Title", value: form.title, onChange: e => setForm({...form, title: e.target.value}), className: "input-dark py-2.5 text-sm rounded-xl", required: true }),
                        e('div', { className: "grid grid-cols-2 gap-3" },
                            e('input', { placeholder: "Location", value: form.location, onChange: e => setForm({...form, location: e.target.value}), className: "input-dark py-2.5 text-sm rounded-xl", required: true }),
                            e('input', { placeholder: "Salary", value: form.salary, onChange: e => setForm({...form, salary: e.target.value}), className: "input-dark py-2.5 text-sm rounded-xl" })
                        ),
                        e('textarea', { placeholder: "Description...", value: form.description, onChange: e => setForm({...form, description: e.target.value}), className: "input-dark py-2.5 text-sm rounded-xl", rows: 3 }),
                        e('button', { className: "w-full py-3 bg-success text-primary font-bold rounded-xl text-sm hover:bg-white transition-all ripple" }, "Submit Post")
                    )
                )
            );
        };

        // --- Dashboard ---
        const Dashboard = ({ user, setPage }) => 
            e('div', { className: "max-w-xl mx-auto space-y-4 pb-20 md:pb-4 fade-in" },
                e('div', { className: "glass rounded-2xl p-6 flex items-center gap-4" },
                    e('div', { className: "w-14 h-14 bg-accent rounded-full flex items-center justify-center text-2xl" }, "ðŸ‘‹"),
                    e('div', null,
                        e('h1', { className: "text-lg font-bold text-white" }, "Assalamu Alaikum!"),
                        e('p', { className: "text-white/60 text-sm" }, user?.user_metadata?.full_name || "Welcome Back")
                    )
                ),
                e('div', { className: "grid grid-cols-2 gap-3" },
                    e('button', { onClick: () => setPage('feed'), className: "glass p-4 rounded-2xl text-left hover:bg-white/10 transition" },
                        e('span', {className: "text-2xl"}, "ðŸ“°"), e('p', {className: "font-bold text-white mt-2"}, "News Feed"), e('p', {className: "text-white/40 text-xs"}, "Latest updates")
                    ),
                    e('button', { onClick: () => setPage('jobs'), className: "glass p-4 rounded-2xl text-left hover:bg-white/10 transition" },
                        e('span', {className: "text-2xl"}, "ðŸ’¼"), e('p', {className: "font-bold text-white mt-2"}, "Jobs"), e('p', {className: "text-white/40 text-xs"}, "Find opportunities")
                    ),
                    e('button', { onClick: () => setPage('reports'), className: "glass p-4 rounded-2xl text-left hover:bg-white/10 transition" },
                        e('span', {className: "text-2xl"}, "ðŸš©"), e('p', {className: "font-bold text-white mt-2"}, "Reports"), e('p', {className: "text-white/40 text-xs"}, "Community watch")
                    ),
                    e('button', { onClick: () => setPage('add_job'), className: "glass p-4 rounded-2xl text-left hover:bg-white/10 transition" },
                        e('span', {className: "text-2xl"}, "âž•"), e('p', {className: "font-bold text-white mt-2"}, "Post Job"), e('p', {className: "text-white/40 text-xs"}, "Hire talent")
                    )
                )
            );

        // --- Content Router ---
        const ContentArea = ({ page, user, setPage }) => {
            const isAdmin = user?.email === ADMIN_EMAIL || user?.user_metadata?.role === 'super_admin';
            const content = {
                'dash': e(Dashboard, { user, setPage }),
                'feed': e(FeedPage, { user }),
                'jobs': e(JobList, { title: "Latest Jobs", filter: 'approved', user }),
                'reports': e(ReportList, { user }),
                'about': e(AboutPage),
                'profile': e(ProfilePage, { user }),
                'add_job': e(AddJobForm, { user, isAdmin }),
                'my_jobs': e(JobList, { title: "My Posts", filter: 'my_posts', user }),
                'approvals': isAdmin ? e(JobList, { title: "Pending Approval", filter: 'pending', isAdmin: true, user }) : null,
                'manage_all': isAdmin ? e(JobList, { title: "Manage All Jobs", filter: 'all', isAdmin: true, user }) : null
            };
            return e('div', { className: "flex-1 overflow-auto p-4 md:p-6" }, content[page] || content['dash']);
        };

        // --- Header (Mobile) ---
        const MobileHeader = ({ user, setOpenSidebar }) => {
            return e('div', { className: "md:hidden sticky top-0 z-20 glass-dark border-b border-white/10 p-3 flex items-center justify-between" },
                e('button', { onClick: () => setOpenSidebar(true), className: "p-1 rounded hover:bg-white/10" }, 
                    e('span', {className: "text-xl"}, "â˜°")
                ),
                e('div', { className: "flex items-center gap-2" },
                    e('img', { src: BRITN_LOGO_URL, className: "w-6 h-6 rounded-md" }),
                    e('span', { className: "font-bold text-white text-sm" }, "BRITN")
                ),
                e('button', { className: "p-1 rounded hover:bg-white/10 relative" }, 
                    e('span', {className: "text-xl"}, "ðŸ””"),
                    e('span', {className: "absolute top-0 right-0 w-2 h-2 bg-danger rounded-full"})
                )
            );
        };

        // --- Main App ---
        const App = () => {
            const [user, setUser] = React.useState(null); const [view, setView] = React.useState('loading'); const [page, setPage] = React.useState('dash'); const [sidebarOpen, setSidebarOpen] = React.useState(false);
            React.useEffect(() => { supabase.auth.getSession().then(({ data: { session } }) => { setUser(session?.user); setView(session ? 'app' : 'login'); }); supabase.auth.onAuthStateChange((e, s) => { setUser(s?.user); setView(s?.user ? 'app' : 'login'); }); }, []);
            
            if (view === 'loading') return e('div', { className: "flex h-screen items-center justify-center" }, e('div', { className: "loader" }));
            if (view === 'login') return e(AuthScreen, { type: 'login', onSwitch: setView, onSuccess: () => setView('app') });
            if (view === 'register') return e(AuthScreen, { type: 'register', onSwitch: setView });

            return e(ToastProvider, null,
                e('div', { className: "flex h-screen" },
                    // Desktop Sidebar Overlay
                    sidebarOpen && e('div', { onClick: () => setSidebarOpen(false), className: "fixed inset-0 z-30 bg-black/20 backdrop-blur-sm md:hidden" }),
                    
                    // Sidebar
                    e(Sidebar, { page, setPage, onLogout: () => supabase.auth.signOut(), role: user?.user_metadata?.role, isOpen: sidebarOpen, setIsOpen: setSidebarOpen, userEmail: user.email }),
                    
                    // Main Area
                    e('div', { className: "flex-1 flex flex-col relative overflow-hidden" },
                        e(MobileHeader, { user, setOpenSidebar: setSidebarOpen }),
                        e(ContentArea, { page, user, setPage }),
                        e(BottomNav, { page, setPage })
                    )
                )
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(e(App));
    </script>
</body>
</html>
